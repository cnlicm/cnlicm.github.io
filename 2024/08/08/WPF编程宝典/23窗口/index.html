<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>WPF编程宝典 - 23窗口 | 生活中的tree</title><meta name="author" content="大白"><meta name="copyright" content="大白"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Window类   Window类继承自ContentControl类。这意味着它只能包含单个子元素（通常是一个布局容器，如Grid控件），并且可使用由Background属性设置的画刷绘制背景。还可以使用BorderBrush和BorderThickness属性在窗口周围添加边框，当该边框会被添加到窗口框架之内（在客户区边缘周围）。可通过将WindowStyle属性设置为None，完全移除窗口框">
<meta property="og:type" content="article">
<meta property="og:title" content="WPF编程宝典 - 23窗口">
<meta property="og:url" content="http://bootree.cn/2024/08/08/WPF%E7%BC%96%E7%A8%8B%E5%AE%9D%E5%85%B8/23%E7%AA%97%E5%8F%A3/index.html">
<meta property="og:site_name" content="生活中的tree">
<meta property="og:description" content="Window类   Window类继承自ContentControl类。这意味着它只能包含单个子元素（通常是一个布局容器，如Grid控件），并且可使用由Background属性设置的画刷绘制背景。还可以使用BorderBrush和BorderThickness属性在窗口周围添加边框，当该边框会被添加到窗口框架之内（在客户区边缘周围）。可通过将WindowStyle属性设置为None，完全移除窗口框">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/wpf.png">
<meta property="article:published_time" content="2024-08-08T12:47:44.000Z">
<meta property="article:modified_time" content="2024-09-20T15:30:57.356Z">
<meta property="article:author" content="大白">
<meta property="article:tag" content="WPF编程宝典">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/wpf.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://bootree.cn/2024/08/08/WPF%E7%BC%96%E7%A8%8B%E5%AE%9D%E5%85%B8/23%E7%AA%97%E5%8F%A3/index.html"><link rel="preconnect" href="https://jsd.012700.xyz"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="NdIUXAOVyGnnBhcrip0ksCawbdAzT0hlBZDE9u4jx6k"/><meta name="msvalidate.01" content="567E47D75E8DCF1282B9623AD914701E"/><meta name="baidu-site-verification" content="code-pE5rnuxcfD"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://jsd.012700.xyz/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://jsd.012700.xyz/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":400},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":150,"languages":{"author":"作者: 大白","link":"链接: ","source":"来源: 生活中的tree","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://jsd.012700.xyz/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'WPF编程宝典 - 23窗口',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-09-20 23:30:57'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="preconnect" href="https://jsd.012700.xyz"><link href="/self/btf.css" rel="stylesheet"><link rel="alternate" href="/atom.xml" title="生活中的tree" type="application/atom+xml">
<link href="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.css" rel="stylesheet" /></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "/img/loading.gif" data-lazy-src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">115</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">20</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">26</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首頁</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fas fa-compass"></i><span> 目录</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fa fa-heartbeat"></i><span> 娱乐</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 图库</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/wpf.png')"><nav id="nav"><span id="blog-info"><a href="/" title="生活中的tree"><span class="site-name">生活中的tree</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首頁</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fas fa-compass"></i><span> 目录</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fa fa-heartbeat"></i><span> 娱乐</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 图库</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">WPF编程宝典 - 23窗口<a class="post-edit-link" href="https://github.com/cnlicm/HexoBlog/tree/main/source/_posts/WPF编程宝典/23窗口.md" rel="external nofollow noreferrer" title="编辑" target="_blank"><i class="fas fa-pencil-alt"></i></a></h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">发表于</span><time datetime="2024-08-08T12:47:44.000Z" title="发表于 2024-08-08 20:47:44">2024-08-08</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/C/">C#</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/C/WPF/">WPF</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">12.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>44分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="WPF编程宝典 - 23窗口"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="window类">Window类</h2>
<p>  <code>Window</code>类继承自<code>ContentControl</code>类。这意味着它只能包含单个子元素（通常是一个布局容器，如Grid控件），并且可使用由Background属性设置的画刷绘制背景。还可以使用<code>BorderBrush</code>和<code>BorderThickness</code>属性在窗口周围添加边框，当该边框会被添加到窗口框架之内（在客户区边缘周围）。可通过将<code>WindowStyle</code>属性设置为None，完全移除窗口框架，从而创建一个可完全定制的窗口。</p>
<div class="note info flat"><p>客户区是窗口边界内部的表面，在其中可放置自定义内容。非客户区包括边框和窗口顶部的标题栏。非客户区由操作系统管理。</p>
</div>
<center>Window类的基本属性</center>
<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>AllowsTransparency</td>
<td>如果设置为 tue，而且如果背景被设置为透明色，Window类就允许其他窗口透过该窗口显示。如果设置为flse(默认值)，窗口背后的内容就永远不能显示，并且透明的背景被呈现为黑色背景。当与 WindowStyle属性结合使用,并把 WindowSytle属性设置为 None时，可创建形状不规则的窗口</td>
</tr>
<tr>
<td>Icon</td>
<td>确定希望用于窗口的图标的 IageSource 对象。图标显示在窗口的左上角(假定窗口具有标准的边框样式)、任务栏中(假定 ShowInTaskBar属性为 tmue)，以及当用户按下 AIt+Tab 组合键时显示的用于在运行中的应用程序之间进行导航的选择窗口中。因为这些图标具有不同的尺寸，所以.ico 文件应当至少包含一幅 16x16 像索和一幅 32X32 像索的图像。实际上，现代Windows 图标标准还添加了一幅 48x48 像素和一幅 256x256 像素的图像,可以根据其他目的改变它们的尺寸。如果 Icon 属性为空引用，窗口会使用和应用程序相同的图形(在 VisualStudio 中可以通过双击 Solution Explorer 中的Properties 节点,然后选择 Application 选项卡进行设置)。如果将此忽略，WPF将使用标准图标来显示窗口，该图标不是很吸引人</td>
</tr>
<tr>
<td>Top和Left</td>
<td>使用设备无关像素设置窗口左上角到屏幕顶部以及左部边缘之间的距离。当任何细节发生变化时，就会触发 LocationChanged 事件。如果 WindowStartupPosition属性设置为 Manual，可在窗口显示之前通过设置这些属性来设置窗口的位置。当窗口显示之后，可以总是使用这些属性移动窗口的位置，而不管WindowStartupPosition属性被设置为何值</td>
</tr>
<tr>
<td>ResizeMode</td>
<td>可以使用 ResizeMode 枚举值决定用户是否可以改变窗口的尺寸。该设置还会影响是否在标题栏上显示最小化和最大化按钮。使用NoResize值可以完全锁定窗口尺寸，CanMinimize 值只允许最小化窗口，CanResize 值允许任意改变窗口尺寸，CanResize-WithGrip 值在窗口右下角添加图形细节，表示可以改变窗口的尺寸</td>
</tr>
<tr>
<td>RestoreBounds</td>
<td>可以使用 ResizeMode 枚举值决定用户是否可以改变窗口的尺寸。该设置还会影响是否在标题栏上显示最小化和最大化按钮。使用NoResize值可以完全锁定窗口尺寸，CanMinimize 值只允许最小化窗口，CanResize 值允许任意改变窗口尺寸，CanResizeWithGrip 值在窗口右下角添加图形细节，表示可以改变窗口的尺寸</td>
</tr>
<tr>
<td>ShowInTasker</td>
<td>如果设置为 tue，会在任务栏和Alt+Tab 列表中显示窗口。通常，只将应用程序主窗口的这一属性设置为 true</td>
</tr>
<tr>
<td>SizeToContent</td>
<td>可使用该属性创建自动放大自身尺寸的窗口。该属性使用SizeToContent枚举值。使用Manual值会禁止窗口自动改变尺寸，使用 Height、Width 或 Width And Height 值允许窗口在不同方向上进行扩展以适应动态内容。当使用SizeToContent属性时，窗口尺寸可以被放大到超出屏幕边界</td>
</tr>
<tr>
<td>Title</td>
<td>显示窗口标题栏（以及任务栏）中的标题</td>
</tr>
<tr>
<td>Topmost</td>
<td>当把该属性设置为true 时，窗口总在应用程序中所有其他窗口的上面显示(除非其他窗口的 TopMost 属性也被设置为 tue)。对于需要“浮动”在其他窗口之上的调色板，这一设置是非常有用的</td>
</tr>
<tr>
<td>WindowStartupLocation</td>
<td>可设置为 WindowStartupLocation 枚举值。如果设置为 Manual 值，就使用 Le 和 Top 属性明确定位窗口:如果设置为 CenterScreen,就在屏幕中央放置窗口;如果设置为 CenterOwncr就在启动该窗口的父窗口的中央显示该窗口。当把非模态窗口的该属性设置为CenterOwncr时，要确保在显示该窗口之前设置新窗口的Ower属性</td>
</tr>
<tr>
<td>WindowState</td>
<td>可设置为 WindowState 枚举值。该属性用于通知当前窗口是否被最大化、最小化或处于正常状态，并允许您进行修改。当该属性改变时会触发StateChanged事件</td>
</tr>
<tr>
<td>WindowStyle</td>
<td>可设置为 WindowStyle 枚举值,该属性决定了窗口的边框。可选择SingleBorderWindow(默认值)、None(在没有标题栏的区域周围有一条凸起的细边框)，另外两个选项已基本上废弃不用(ThreeDBorderWindow和ToolWindow)。如果准备在 Windows8上运行应用程序情况尤其如此</td>
</tr>
</tbody>
</table>
<p>  此外，Window 类还提供了LocationChanged 和 WindowStateChanged 事件，当窗口的位置和WindowState 属性发生改变时会相应地触发这两个事件。</p>
<h3 id="显示窗口">显示窗口</h3>
<p>  为显示窗口，需要创建 Window 类的实例并使用 Show()或 ShowDialog( )方法。</p>
<p>  <strong>ShowDialog()方法显示模态窗口。模态窗口通过锁住所有鼠标和键盘输入来阻止用户访问父窗口，直到模态窗口被关闭。此外，直到模态窗口被关闭后，ShowDialog()方法才返回。所以，在 ShowDialog()方法调用之后放置的任何代码都会被阻塞(然而，这并不意味着其他代码无法运行。</strong> <em>例如，如果有正在运行的计时器，那么计时器的事件处理程序仍将运行)。在代码中，通常的模式是显示一个模态窗口，等待直到它被关闭，然后使用它的数据。</em></p>
<blockquote>
<p>下面是使用<code>ShowDialog()</code>方法的一个示例</p>
</blockquote>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">TaskWindow winTask = <span class="keyword">new</span> TaskWindow();</span><br><span class="line">winTask.ShowDialog();</span><br></pre></td></tr></table></figure>
<p>  **Show()方法显示非模态窗口，非模态窗口不会阻止用户访问其他任何窗口。而且当窗口显示之后，Show()方法会立即返回，所以后续代码语句会立即执行。**可创建并显示几个非模态窗口，而且用户能够同时和它们进行交互。当使用非模态窗口时，有时需要同步代码，以确保在一个窗口中的改变能更新另一个窗口中的信息，从而防止用户使用无效的信息。</p>
<blockquote>
<p>下面是使用<code>Show()</code>方法的一个示例</p>
</blockquote>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MainWIndow winMain = <span class="keyword">new</span> MainWindow();</span><br><span class="line">winMain.Show();</span><br></pre></td></tr></table></figure>
<p>  关闭窗口非常简单，只需要使用Close()方法。此外，可使用Hide()方法或将 Visibility 属性设置为 Hidden 来隐藏窗口。不管使用哪种方式隐藏窗口，对于代码来说窗口仍然是打开的和可见的。通常，只隐藏非模态窗口是有意义的。因为如果隐藏模态窗口，代码执行会被阻塞(直到窗口被关闭为止)，然而用户不能关闭不可见的窗口。</p>
<h3 id="定位窗口">定位窗口</h3>
<p>  通常不需要在屏幕上准确定位窗口。只将窗口状态设置为CenterOwner,并忽略其他所有细节。另一方面，在较少情况下，会将窗口状态设置为 Manual，并使用Left 和 Right属性准确设置窗口的位置。</p>
<p>  可限制窗口的尺寸以使其支持最小的显示器,但是这会让高端用户感到沮丧(它们为了在屏幕上一次显示更多信息，已经专门购买了更好的显示器)。对于这种情况，通常希望在运行时决定窗口的最佳位置。为此，需要使用 <code>System.Windows.SystemParameters</code> 类来检索有关屏幕实际大小的基本信息。</p>
<p>  **<code>SystemParameters</code> 类包含大量静态属性，可返回各种有关系统设置的信息。例如，可使用<code>SystemParameters</code> 类决定用户是否启用了热跟踪(hot tracking)选项、拖动整个窗口选项以及其他选项。对于窗口，SystemParameters 类特别有用，因为它提供的两个属性可给出当前屏幕的大小: <code>FullPrimaryScreenHeight</code> 和 <code>FullPrimaryScreenWidth</code>。**这两个属性都非常简单,下面是一些(在运行时将窗口定位在屏幕中央)演示代码:</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">double</span> screeHeight = SystemParameters.FullPrimaryScreenHeight;</span><br><span class="line"><span class="built_in">double</span> screeWidth = SystemParameters.FullPrimaryScreenWidth;</span><br><span class="line"><span class="keyword">this</span>.Top = (screenHeight - <span class="keyword">this</span>.Height) / <span class="number">2</span>;</span><br><span class="line"><span class="keyword">this</span>.Left = (screenWidth - <span class="keyword">this</span>.Width) / <span class="number">2</span>;</span><br></pre></td></tr></table></figure>
<p>  尽管使用这些代码和将窗口状态设置为CenterScreen的效果相同，但使用代码具有实现不同定位逻辑的灵活性，并且可在适当的时间运行这些定位逻辑。<br>
  <strong>更好的选择是使用 SystemParameters.WorkArea矩形，使窗口位于可用屏幕区域的中央。工作区域不包括停靠任务栏(以及其他停靠到桌面的工具栏)的区域。</strong></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">double</span> workHeight = SystemParameters.WorkArea.Height;</span><br><span class="line"><span class="built_in">double</span> workWidth = SystemParameters.WorkArea.Width;</span><br><span class="line"><span class="keyword">this</span>.Top = (workHeight - <span class="keyword">this</span>.Height) / <span class="number">2</span>;</span><br><span class="line"><span class="keyword">this</span>.Left = (workWidth - <span class="keyword">this</span>.Width) / <span class="number">2</span>;</span><br></pre></td></tr></table></figure>
<div class="note warning flat"><p>这两个窗口定位示例都存在一个小的缺陷。当为已经可见的窗口设置 Top 属性时，窗口会被立即移动和刷新。当使用后面的代码行设置Le属性时，会发生同样的过程。因此，视觉敏锐的用户会看到两次窗口移动。但是，Window 类没有提供方法来同时设置这两个位置属性。<strong>唯一的解决方法是在窗口创建之后，但尚未通过调用 Show()或 ShowDialog( )方法显示之前定位窗口。</strong></p>
</div>
<h3 id="保存和还原窗口位置">保存和还原窗口位置</h3>
<p>  经常需要让窗口记住它上一次的位置。这一信息可存储到特定于用户的配置文件或Windows注册表中。<br>
  如果希望在特定于用户的配置文件中存储重要窗口的位置，可首先双击 <em>Solution Explorer</em> 中的 <em>Properties</em> 节点，然后选择 <em>Settings</em> 选项卡。接着使用 <code>System.Windows.Rect</code> 数据类型(<em>但是发现没有Rect类型，因此这里采用string，需要自行序列化</em>)添加用户范围的设置，如下图所示。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> win = <span class="keyword">new</span> Window();</span><br><span class="line">Properties.Settings.Default.WindowPosition = JsonSerializer.Serialize(win.RestoreBounds);</span><br></pre></td></tr></table></figure>
<p>  需要注意的是，上面的代码使用了RestoreBounds属性，即使窗口当前被最大化或最小化该属性也能提供正确的范围(最后的非最大化和非最小化尺寸)。当需要时，检索此信息也同样很简单：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> win = <span class="keyword">new</span> Window();</span><br><span class="line">    Rect bound = JsonSerializer.Deserialize&lt;Rect&gt;(Properties.Settings.Default.WindowPosition);</span><br><span class="line">    win.Top = bound.Top;</span><br><span class="line">    win.Left = bound.Left;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Restore the size only for a manually sized window.</span></span><br><span class="line">    <span class="keyword">if</span> (win.SizeToContent == SizeToContent.Manual)</span><br><span class="line">    &#123;</span><br><span class="line">        win.Width = bound.Width;</span><br><span class="line">        win.Height = bound.Height;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> </span><br><span class="line">&#123;</span><br><span class="line">    MessageBox.Show(<span class="string">&quot;No settings stopred.&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  该方法唯一的限制是需要为每个准备保存的窗口创建单独的属性。如果需要为许多不同的窗口保存位置，可能希望设计一个更灵活的系统。例如，下面的辅助类为传递给它的任何窗口保存位置，并使用包含窗口名称的注册表键(如果希望为几个同名窗口保存设置，可以使用附加的标识信息)。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">WindowPositionHelper</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">string</span> RegPath = <span class="string">@&quot;Software\MyApp\WindowBounds\&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">SaveSize</span>(<span class="params">Window win</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Create or retrieve a reference to a key where the settings will be stored.</span></span><br><span class="line">        RegistryKey key = Registry.CurrentUser.CreateSubKey(RegPath + win.Name);</span><br><span class="line"></span><br><span class="line">        key.SetValue(<span class="string">&quot;Bounds&quot;</span>, win.RestoreBounds.ToString());</span><br><span class="line">        key.SetValue(<span class="string">&quot;Bounds&quot;</span>, win.RestoreBounds.ToString(CultureInfo.InvariantCulture));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">SetSize</span>(<span class="params">Window win</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        RegistryKey? key = Registry.CurrentUser.OpenSubKey(RegPath + win.Name);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (key != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Rect bounds = Rect.Parse(key.GetValue(<span class="string">&quot;Bounds&quot;</span>).ToString());</span><br><span class="line">            win.Top = bounds.Top;</span><br><span class="line">            win.Left = bounds.Left;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Restore the size only for a manually sized window.</span></span><br><span class="line">            <span class="keyword">if</span> (win.SizeToContent == SizeToContent.Manual)</span><br><span class="line">            &#123;</span><br><span class="line">                win.Width = bounds.Width;</span><br><span class="line">                win.Height = bounds.Height;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  为在窗口中使用该类，当窗口关闭时调用SaveSize()方法，并当首次打开窗口时调用SetSize( )方法。对于每种情况，都需要传递窗口引用，使其指向希望辅助类检査的窗口。需要注意的是在这个示例中，每个窗口的Name 属性的值都不能相同。</p>
<h2 id="窗口交互">窗口交互</h2>
<p>  <code>Application</code>类提供了用于访问其他窗口的两个工具：<code>MainWindow</code>和<code>Windows</code>属性。如果希望按自己的方式跟踪窗口，例如保持跟踪某个特定窗口类的实例（该类可能代表文档），可在<code>Application</code>类中添加自己的静态属性。</p>
<p>  当然，获取其他窗口的引用只是工作的一部分，还需要决定如何进行通信。作为通用规则应当尽可能减少窗口之间交互的需要，因为这会无谓地增加代码的复杂性。如果确实需要根据一个窗口中的动作修改另一个窗口中的控件，可在目标窗口中创建专用方法。这样可确保依赖性被很好地标识，并添加额外的间接层，这样更容易适应窗口接口的变化。</p>
<div class="note info flat"><p>如果两个窗口之间具有复杂的交互，并且单独地被开发或部署，或者很可能会改变，这时可以考虑得更长远一些，可以通过创建具有公共方法的接口来规范化它们之间的交互，并在自定义的窗口类中实现该接口。</p>
</div>
<p>  下图显示了这一模式的两个示例，第一个示例中，一个窗口通过触发第二个窗口来刷新它的数据，以便响应按钮的单击事件。该窗口没有试图直接修改第二个窗口的用户界面，而是依赖于自定义的名为<code>DoUpdate()</code>的中间方法。</p>
<center>单一窗口交互</center>
<img src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/20240808214925.png" width="60%"/>
<p>  显示了需要更新多个窗口的情况。对于这种情况，动作窗口依靠一个更高层的应用程序方法,该方法调用所需的窗口更新方法(可能通过迭代窗口集合来实现)。这种方法的效果更好，因为可以在更高层次上工作。上图显示的方法中，动作窗口不需要了解有关接收窗口中控件的特定内容。下图显示的方法中更进一步——动作窗口根本不需要了解接收窗口的任何内容。</p>
<center>一个窗口和多个窗口之间的交互</center>
<img src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/20240808215123.png" width="60%"/>
<div class="note info flat"><p>当在窗口之间进行交互时，Window.Activate()方法通常可以带来方便。该方法可将所期望的窗口转换为活动窗口。还可以用 WindowIsActive 属性测试某个窗口当前是否是活动窗口，以及是否是唯一的活动窗口。</p>
</div>
<p>  可以进一步降低该例中窗口之间的耦合程度。不是使用Application类触发各窗口中的方法而是仅仅触发一个事件，并允许窗口选择如何响应该事件。</p>
<h3 id="窗口所有权">窗口所有权</h3>
<p>  .NET 允许一个窗口“拥有”其他窗口。对于浮动的工具框和命令窗口而言，被拥有的窗口是很有用的。被拥有的窗口的典型示例是 Microsoft Word 中的查找和替换窗口。当所有者窗口最小化时，也会自动最小化被拥有的窗口。当被拥有的窗口与拥有者窗口相互重叠时，被拥有的窗口总显示在上面。</p>
<p>  为支持窗口之间的拥有关系，Window 类增加了两个属性。0wer属性是指向窗口的引用，引用的窗口拥有当前窗口(如果存在的话)。OwnedWindows 属性是当前窗口拥有的所有窗口(如果包含有窗口的话)的集合。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a new window</span></span><br><span class="line">ToolWindow winTool = <span class="keyword">new</span> ToolWindow();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Designate the current window as the owner</span></span><br><span class="line">winTool.Owner = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Show the owned window</span></span><br><span class="line">winTool.Show();</span><br></pre></td></tr></table></figure>
<p>  被拥有的窗口始终以非模态方式显示。为移除被拥有的窗口，需要将其Owner 属性设置为空引用。</p>
<div class="note info flat"><p>WPF 没有提供用于构建多文档用户界面(MDI)应用程序的系统。如果希望更复杂的窗口管理，那么需要自己构建(或购买第三方组件)。</p>
</div>
<p>  <strong>被拥有的窗口可拥有其他窗口，后者又可以拥有另外的窗口，等等(尽管这种设计的实际用途值得怀疑)。唯一的限制是窗口不能拥有自身，并且两个窗口不能相互拥有。</strong></p>
<h3 id="对话框模型">对话框模型</h3>
<p> &amp;emsp通常，当显示模态窗口时，是为了给用户提供一些选择。显示窗口的代码等待选择结果，通常，当显示模态窗口时，然后根据选择执行相应的操作。这种设计称为对话框模型(dialog model)。以模态方式显示的窗口就是对话框。</p>
<p>  通过在对话框中创建一些公共属性，可以很容易地使用这种设计模式。当用户在对话框中进行选择时，将会设置这些属性，然后关闭对话框。此后显示对话框的代码可检查相应的属性并根据其值决定下一步要进行的操作(需要注意，即使对话框已经被关闭，对话框对象及其所有控件信息也仍然存在，直到引用变量超出了其作用域为止)。</p>
<p>  <strong>幸运的是，这种结构的某些内容已经被固化到 Window类中。每个窗口都包含预先准备好的 DialogResult 属性，该属性可以设置为tue、false 或 nul 值。通常，tue 表示用户选择继续进行操作(例如，单击 OK 按钮)，而false 表示用户取消了操作。</strong></p>
<p>  最方便的是,一旦设置 DialogResult属性,就会为调用代码返回该属性值作为 ShowDialog()方法的返回值。这意味着可使用下面的简洁代码来创建、显示对话框并使用其结果:</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">DialogWindow dialog = <span class="keyword">new</span> DialogWindow();</span><br><span class="line"><span class="keyword">if</span>(dialog.ShowDialog() == <span class="literal">true</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// The user accepted the action. Full speed ahead.</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// The user canceled the action</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<div class="note info flat"><p>使用 DialogResult 属性没有妨碍为自己的窗口添加自定义属性。例如，使用 DialogResult 属性通知调用代码某个动作是否被接受或取消，并通过自定义属性提供其他重要细节，这是非常合理的。如果调用代码发现 DialogResult属性为 tue,就可以检查其他属性以获取它所需要的信息。</p>
</div>
<p>  <em>还可以使用其他更简便的方法。不是当用户单击了按钮后手动设置 DialogResut 属性，而是将按钮指定为接受按钮(通过将IsDefault属性设置为true)。当单击按钮时会自动地将对话框的 DialogResult 属性设置为 true。类似地，可将按钮指定为取消按钮(通过将IsCancel 属性设置为 true)，对于这种情况，单击按钮会将 DialogResult属性设置为Cancel</em></p>
<h3 id="通用对话框">通用对话框</h3>
<p>  Windows操作系统提供了许多内置对话框，可通过<strong>Window API</strong>访问这些对话框。WPF为其中的即可对话框提供了封装程序。</p>
<div class="note info flat"><p>由于多种原因，WPF 没有为所有 Windows API 提供封装程序。WPF 的目标之一是与WindowsAP相互独立，从而可在其他环境(如浏览器)中使用或移植到其他平台。此外，许多内置对话框是非常古老的，对于现代应用程序它们不应当是第一选择。</p>
</div>
<blockquote>
<p>MessageBox</p>
</blockquote>
<p>  最常见的对话框是 System.Windows.MessageBox类，该类提供了静态的 Show()方法。可使用该类显示标准的 Windows 消息框。下面是最常用的重载方法:</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MessageBox.Show(<span class="string">&quot;You must enter a name.&quot;</span>,<span class="string">&quot;Name Entry Error&quot;</span>,MessageBoxButton.OK,MessageBoxImage.Exclamation);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>PrintDialog</p>
</blockquote>
<p>  专门用于打印的类</p>
<blockquote>
<p>OpenFileDialog和SaveFileDialog</p>
</blockquote>
<p>  OpenFileDialog类用于弹窗选择某个文件，SaveFileDialog用于弹窗选择保存文件.</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">OpenFileDialog myDialog = <span class="keyword">new</span> OpenFileDialog();</span><br><span class="line"></span><br><span class="line">myDialog.Filter = <span class="string">&quot;Image Files(*BMPO;*.JPG;*.GIF)|*BMPO;*.JPG;*.GIF | All files(*.*)|*.*&quot;</span> ;</span><br><span class="line">myDialog.CheckFileExists = <span class="literal">true</span>;</span><br><span class="line">myDialog.Multiselect = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(myDialog.ShowDialog() == <span class="literal">true</span>)</span><br><span class="line">&#123;</span><br><span class="line">    lstFiles.Items.Clear();</span><br><span class="line">    <span class="keyword">foreach</span>(<span class="built_in">string</span> file <span class="keyword">in</span> myDialog.FileNames)</span><br><span class="line">    &#123;</span><br><span class="line">        lstFiles.Items.Add(file);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<div class="note warning flat"><p>WPF 没有提供颜色拾取器、字体拾取器以及文件夹浏览器(<a target="_blank" rel="noopener external nofollow noreferrer" href="http://xn--gqq4ex5lb07b.NET">但可使用.NET</a> 2.0中的 <code>System.Windows.Forms</code> 类获取这些要素)。</p>
</div>
<h2 id="非矩形窗口">非矩形窗口</h2>
<p>  对于时髦的客户应用程序，经常会使用形状不规则的窗口，如图片编辑程序、视频制作程序以及 MP3 播放器。在 WPF 中创建使用基本形状的窗口是非常容易的。然而，创建精致的、具有专业外观的窗口需要完成更多工作–并且，很可能需要由优秀的图形设计人员创建轮廓并设计背景插图。</p>
<h3 id="简单形状窗口">简单形状窗口</h3>
<p>  创建简单形状窗口需要使用以下几个步骤：</p>
<ol>
<li>将<code>Window.AllowsTransparency</code>属性设置为<em>true</em></li>
<li>将<code>Window.WindowStyle</code>属性设置为<em>Node</em>，从而隐藏窗口的非客户区（蓝色边框）。如果不这样做，当试图显示窗口时会抛出<em>InvalidOperationException</em>异常</li>
<li>将窗口背景设置为透明（可使用<em>Transparent</em>颜色，该颜色的alpha值为0），或将背景设置为具有透明区域的图像（透明区域时使用alpha值为0的颜色绘制的区域）</li>
</ol>
<p>  这三个步骤可有效地移除窗口的标准外观（对于WPF专业人员来说，这些标准外观就是窗口的装饰元素）。为得到简单形状窗口效果，现在需要提供一些不透明的具有所需形状的内容。有多种选择：</p>
<ul>
<li>使用支持透明格式的文件提供背景插图。例如，<em>可使用PNG文件提供窗口的背景。这是比较简明直观的方法，并且如果正在和未掌握XAML知识的设计人员合作，这种方法是比较合适的。然而，因为在具有更高系统DPI的窗口中呈现时需要使用更多的像素，背景图形可能变得模糊。当允许用户改变窗口尺寸时，也存在这一问题。</em></li>
<li>使用WPF中的形状绘制功能创建具有矢量内容的背景。不管是改变窗口尺寸还是改变系统DPI设置，该方法可以确保不损失质量。然而，可能希望使用支持XAML的设计工具，例如Expression Blend</li>
<li>使用更简单的具有所需形状的WPF元素。例如，可使用Border元素创建出具有圆角边缘的美观窗口。通过这一方法不需要额外的设计工作，就可以实现具有现代Office风格的窗口外观</li>
</ul>
<img src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/20240809204716.png"/>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Window</span></span></span><br><span class="line"><span class="tag">    <span class="attr">AllowsTransparency</span>=<span class="string">&quot;True&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">Background</span>=<span class="string">&quot;Transparent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">Height</span>=<span class="string">&quot;375&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">Title</span>=<span class="string">&quot;MainWindow&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">Width</span>=<span class="string">&quot;450&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">WindowStartupLocation</span>=<span class="string">&quot;CenterScreen&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">WindowStyle</span>=<span class="string">&quot;None&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">x:Class</span>=<span class="string">&quot;WpfApp.MainWindow&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns</span>=<span class="string">&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:x</span>=<span class="string">&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Border</span></span></span><br><span class="line"><span class="tag">        <span class="attr">BorderBrush</span>=<span class="string">&quot;#395984&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">BorderThickness</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">CornerRadius</span>=<span class="string">&quot;0, 20, 30, 40&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">Height</span>=<span class="string">&quot;Auto&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">Name</span>=<span class="string">&quot;windowFrame&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">Width</span>=<span class="string">&quot;Auto&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Border.Background</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">LinearGradientBrush</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">GradientStop</span> <span class="attr">Color</span>=<span class="string">&quot;#E7EbF7&quot;</span> <span class="attr">Offset</span>=<span class="string">&quot;0.0&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">GradientStop</span> <span class="attr">Color</span>=<span class="string">&quot;#CEE3FF&quot;</span> <span class="attr">Offset</span>=<span class="string">&quot;0.5&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">LinearGradientBrush</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Border.Background</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">Grid</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Grid.RowDefinitions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">RowDefinition</span> <span class="attr">Height</span>=<span class="string">&quot;Auto&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">RowDefinition</span> <span class="attr">Height</span>=<span class="string">&quot;*&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">RowDefinition</span> <span class="attr">Height</span>=<span class="string">&quot;Auto&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Grid.RowDefinitions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">TextBlock</span></span></span><br><span class="line"><span class="tag">                <span class="attr">Margin</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">Padding</span>=<span class="string">&quot;5&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">Text</span>=<span class="string">&quot;Title Bar&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">Grid</span> <span class="attr">Background</span>=<span class="string">&quot;#B5CBEF&quot;</span> <span class="attr">Grid.Row</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TextBlock</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">FontSize</span>=<span class="string">&quot;20&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">Foreground</span>=<span class="string">&quot;White &quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">HorizontalAlignment</span>=<span class="string">&quot;Center&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">VerticalAlignment</span>=<span class="string">&quot;Center&quot;</span>&gt;</span></span><br><span class="line">                    Content Goes Heer</span><br><span class="line">                <span class="tag">&lt;/<span class="name">TextBlock</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Grid</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">TextBlock</span></span></span><br><span class="line"><span class="tag">                <span class="attr">Grid.Row</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">HorizontalAlignment</span>=<span class="string">&quot;Center&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">Margin</span>=<span class="string">&quot;1,10,1,1&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">Padding</span>=<span class="string">&quot;5&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">Text</span>=<span class="string">&quot;Footer&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Grid</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Border</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Window</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="具有形状内容的透明窗口">具有形状内容的透明窗口</h3>
<p>  在大多数情况下，WPF窗口不实用固定图形创建任意形状窗口。相反，会使用完全透明的背景，然后在该背景上放置形状内容。该方法的优点时更加模块化。可使用许多独立组件组装窗口，所有这些组件都是基本的WPF元素。而且更重要的是，该方法可以充分利用其他WPF功能构建真正的动态用户界面。例如，可在窗口中组装能改变尺寸的形状内容或使用动画创建一直运行的效果。如果使用单一的静态文件提供图形，这是很难实现的。</p>
<img src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/20240809205739.png"/>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Window</span></span></span><br><span class="line"><span class="tag">    <span class="attr">AllowsTransparency</span>=<span class="string">&quot;True&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">Background</span>=<span class="string">&quot;Transparent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">Height</span>=<span class="string">&quot;375&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">Title</span>=<span class="string">&quot;MainWindow&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">Width</span>=<span class="string">&quot;450&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">WindowStartupLocation</span>=<span class="string">&quot;CenterScreen&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">WindowStyle</span>=<span class="string">&quot;None&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">x:Class</span>=<span class="string">&quot;WpfApp.MainWindow&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns</span>=<span class="string">&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:local</span>=<span class="string">&quot;clr-namespace:WpfApp.ViewModels&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:x</span>=<span class="string">&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Window.DataContext</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">local:MainWindowViewModel</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Window.DataContext</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Path</span> <span class="attr">Stroke</span>=<span class="string">&quot;DarkGray&quot;</span> <span class="attr">StrokeThickness</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Path.Fill</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">LinearGradientBrush</span> <span class="attr">EndPoint</span>=<span class="string">&quot;0.8,1&quot;</span> <span class="attr">StartPoint</span>=<span class="string">&quot;0.2,0&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">LinearGradientBrush.GradientStops</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">GradientStop</span> <span class="attr">Color</span>=<span class="string">&quot;White&quot;</span> <span class="attr">Offset</span>=<span class="string">&quot;0&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">GradientStop</span> <span class="attr">Color</span>=<span class="string">&quot;White&quot;</span> <span class="attr">Offset</span>=<span class="string">&quot;0.45&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">GradientStop</span> <span class="attr">Color</span>=<span class="string">&quot;LightBlue&quot;</span> <span class="attr">Offset</span>=<span class="string">&quot;0.9&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">GradientStop</span> <span class="attr">Color</span>=<span class="string">&quot;Gray&quot;</span> <span class="attr">Offset</span>=<span class="string">&quot;1&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">LinearGradientBrush.GradientStops</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">LinearGradientBrush</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Path.Fill</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Path.Data</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PathGeometry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">PathGeometry.Figures</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">PathFigure</span> <span class="attr">IsClosed</span>=<span class="string">&quot;True&quot;</span> <span class="attr">StartPoint</span>=<span class="string">&quot;20,0&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">LineSegment</span> <span class="attr">Point</span>=<span class="string">&quot;140,0&quot;</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">ArcSegment</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">Point</span>=<span class="string">&quot;160,20&quot;</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">Size</span>=<span class="string">&quot;20,20&quot;</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">SweepDirection</span>=<span class="string">&quot;Clockwise&quot;</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">LineSegment</span> <span class="attr">Point</span>=<span class="string">&quot;160,60&quot;</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">ArcSegment</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">Point</span>=<span class="string">&quot;140,80&quot;</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">Size</span>=<span class="string">&quot;20,20&quot;</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">SweepDirection</span>=<span class="string">&quot;Clockwise&quot;</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">LineSegment</span> <span class="attr">Point</span>=<span class="string">&quot;70,80&quot;</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">LineSegment</span> <span class="attr">Point</span>=<span class="string">&quot;70,130&quot;</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">LineSegment</span> <span class="attr">Point</span>=<span class="string">&quot;40,80&quot;</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">LineSegment</span> <span class="attr">Point</span>=<span class="string">&quot;20,80&quot;</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">ArcSegment</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">Point</span>=<span class="string">&quot;0,60&quot;</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">Size</span>=<span class="string">&quot;20,20&quot;</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">SweepDirection</span>=<span class="string">&quot;Clockwise&quot;</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">LineSegment</span> <span class="attr">Point</span>=<span class="string">&quot;0,20&quot;</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">ArcSegment</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">Point</span>=<span class="string">&quot;20,0&quot;</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">Size</span>=<span class="string">&quot;20,20&quot;</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">SweepDirection</span>=<span class="string">&quot;Clockwise&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">PathFigure</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">PathGeometry.Figures</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">PathGeometry</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Path.Data</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Path</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Window</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>  目前，Path 元素的尺寸是固定的(窗口的尺寸也是固定的)，但可以将之放到 Viewbox 容器中以改变尺寸。通过增加关闭按钮的逼真度——在红色表面上绘制矢量的 X 图标，还可以进一步改进该例。尽管可使用单独的 Path 元素代表按钮并处理按钮的鼠标事件，但是使用控件模板来改变标准 Button 控件会更好一些。然后可让 Path 元素绘制白定义按钮的 X 图标部分。</p>
<h3 id="移动形状窗口">移动形状窗口</h3>
<p>  形状窗体所受的限制之一是没有属于非客户区的标题栏部分，标题栏允许用户很容易地在桌面上拖动窗口。幸运的是，在 WPF 中，可随时通过调用 Window,DragMove()方法启动窗口拖动模式。</p>
<p>  所以，为允许用户拖动在上一个示例中看到的任意形状窗体，只需要为窗口(或窗口上的-个元素，该元素将扮演和标题栏相同的角色)处理 MouseLefButtonDown 事件:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">TextBlock</span> <span class="attr">Text</span>=<span class="string">&quot;Title Bar&quot;</span> <span class="attr">Margin</span>=<span class="string">&quot;1&quot;</span> <span class="attr">Padding</span>=<span class="string">&quot;5&quot;</span> <span class="attr">MouseLeftButtonDown</span>=<span class="string">&quot;titleBar_MouseLeftButtonDown&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>  在事件处理程序中只需一行代码：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">titleBar_MouseLeftButtonDown</span>(<span class="params"><span class="built_in">object</span> sender,MouseButtonEventArgs e</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">this</span>.DragMove();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  现在窗口就会跟随鼠标在桌面上移动了，直到用户释放鼠标为止</p>
<h3 id="改变形状窗口的尺寸">改变形状窗口的尺寸</h3>
<p>  改变形状窗口的尺寸不是很容易。如果窗口的形状大体上是矩形，最简单的方法是通过将Window,ResizeMode 属性设置为 CanResizeWithGrip，这时会在窗口的右下角添加用于改变窗口尺寸的图形手柄(grip)。</p>
<p>  如果手柄不能放到窗口的正确位置上，或者希望允许用户通过拖动窗口边缘来改变窗口的尺寸，就需要进行更多的工作。可使用两种基本方法。可使用NET的平台调用特性(Pnvoke)发送改变窗口尺寸的 Win32 消息。或者，当用户拖动一条侧边时，简单地跟踪鼠标位置，并通过设置窗口的 Width 属性来手动改变窗口的尺寸。下面的示例使用后一种技术。</p>
<p>  在使用每种技术之前，需要有一种方式来探测用户何时会将鼠标移到窗口边缘上。这时，鼠标指针应当变为可以改变尺寸的光标。在 WPF中完成该任务的最简单方法是在每个窗口的边上放置一个元素。该元素不需要具有任何可视化外观–实际上，它可以是完全透明的并且可以让窗口透过该元素显示。它唯一的目的是截获鼠标事件。</p>
<img src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/20240809211821.png"/>
<div class="tabs" id="changewindowsize"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="changewindowsize-1">MainWindow</button><button type="button" class="tab " data-href="changewindowsize-2">MainWindow.xaml.cs</button></ul><div class="tab-contents"><div class="tab-item-content active" id="changewindowsize-1"><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Rectangle</span></span></span><br><span class="line"><span class="tag">    <span class="attr">Cursor</span>=<span class="string">&quot;SizeWE&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">Fill</span>=<span class="string">&quot;Transparent&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">HorizontalAlignment</span>=<span class="string">&quot;Right&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">MouseLeftButtonDown</span>=<span class="string">&quot;window_initiateWiden&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">MouseLeftButtonUp</span>=<span class="string">&quot;window_endWiden&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">MouseMove</span>=<span class="string">&quot;window_Widen&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">VerticalAlignment</span>=<span class="string">&quot;Stretch&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">Width</span>=<span class="string">&quot;5&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="changewindowsize-2"><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">MainWindow</span> : <span class="title">Window</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MainWindow</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        InitializeComponent();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">bool</span> isWiden = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">window_initiateWiden</span>(<span class="params"><span class="built_in">object</span> sender, MouseButtonEventArgs e</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        isWiden = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">window_Widen</span>(<span class="params"><span class="built_in">object</span> sender, MouseEventArgs e</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Rectangle rect = (Rectangle)sender;</span><br><span class="line">        <span class="keyword">if</span> (isWiden)</span><br><span class="line">        &#123;</span><br><span class="line">            rect.CaptureMouse();</span><br><span class="line">            <span class="built_in">double</span> newWidth = e.GetPosition(<span class="keyword">this</span>).X + <span class="number">5</span>;</span><br><span class="line">            <span class="keyword">if</span> (newWidth &gt; <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">this</span>.Width = newWidth;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">window_endWiden</span>(<span class="params"><span class="built_in">object</span> sender, MouseButtonEventArgs e</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        isWiden = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div>
<h3 id="窗口的自定义控件模板">窗口的自定义控件模板</h3>
<p>  使用到目前为止看到的代码，可很容易地构建具有自定义形状的窗口。然而，<strong>如果希望为整个应用程序使用新的窗口标准，就必须以手动方式重新设置具有相同形状边框、题头区域和关闭按钮等内容的所有窗口。对于这种情况，更好的方法是将标记改编成可用于任意窗口的控件模板。</strong></p>
<p>  第一步是查阅 Window 类的默认控件模板。对于大部分内容，这个模板是很简单的，但是它包含了一个您可能不希望的细节:AdormerDecorator 元素。这个元素在窗口的其他客户内容之上创建了一个特定的绘图区域，称为装饰层(adorner layer)。WPF 控件可使用装饰层绘制应当在元素上重叠显示的内容，包括一些用于显示焦点、标志验证错误以及指导拖放操作的小图形指示内容。当构建自定义窗口时，需要确保提供装饰层，从而可以让使用装饰层的控件能够继续使用。</p>
<p>  为提供装饰层，可使用下面的标记确定窗口控件模板应当采用的基本结构。下面是一个标准化示例：</p>
<img src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/20240809213712.png" width="40%" style="border:1px solid black"/>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Window</span></span></span><br><span class="line"><span class="tag">    <span class="attr">AllowsTransparency</span>=<span class="string">&quot;True&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">Background</span>=<span class="string">&quot;Transparent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">Height</span>=<span class="string">&quot;375&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">Title</span>=<span class="string">&quot;MainWindow&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">Width</span>=<span class="string">&quot;450&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">WindowStartupLocation</span>=<span class="string">&quot;CenterScreen&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">WindowStyle</span>=<span class="string">&quot;None&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">x:Class</span>=<span class="string">&quot;WpfApp.MainWindow&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns</span>=<span class="string">&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:local</span>=<span class="string">&quot;clr-namespace:WpfApp.ViewModels&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:x</span>=<span class="string">&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Window.DataContext</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">local:MainWindowViewModel</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Window.DataContext</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Window.Template</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ControlTemplate</span> <span class="attr">TargetType</span>=<span class="string">&quot;&#123;x:Type Window&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Border</span> <span class="attr">Name</span>=<span class="string">&quot;windowFrame&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">Grid</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">Grid.RowDefinitions</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">RowDefinition</span> <span class="attr">Height</span>=<span class="string">&quot;Auto&quot;</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">RowDefinition</span> <span class="attr">Height</span>=<span class="string">&quot;*&quot;</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">RowDefinition</span> <span class="attr">Height</span>=<span class="string">&quot;Auto&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">Grid.RowDefinitions</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">&lt;!--  The title bar  --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">TextBlock</span> <span class="attr">FontWeight</span>=<span class="string">&quot;Bold&quot;</span> <span class="attr">Text</span>=<span class="string">&quot;&#123;TemplateBinding Title&#125;&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">HorizontalAlignment</span>=<span class="string">&quot;Right&quot;</span>&gt;</span>❌<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">&lt;!--  The window content  --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">Border</span> <span class="attr">Grid.Row</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">AdornerDecorator</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">ContentPresenter</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">AdornerDecorator</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">Border</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">&lt;!--  The footer  --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">ContentPresenter</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">Content</span>=<span class="string">&quot;&#123;TemplateBinding Tag&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">Grid.Row</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">HorizontalAlignment</span>=<span class="string">&quot;Center&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">Margin</span>=<span class="string">&quot;10&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">&lt;!--  The resize grip  --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">ResizeGrip</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">Grid.Row</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">HorizontalAlignment</span>=<span class="string">&quot;Right&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">IsTabStop</span>=<span class="string">&quot;False&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">Name</span>=<span class="string">&quot;WindowResizeGrip&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">VerticalAlignment</span>=<span class="string">&quot;Bottom&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">Visibility</span>=<span class="string">&quot;Collapsed&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">&lt;!--  The invisible rectangles that allow dragging to resize.  --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">Rectangle</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">Cursor</span>=<span class="string">&quot;SizeWE&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">Fill</span>=<span class="string">&quot;Transparent&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">Grid.Row</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">Grid.RowSpan</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">HorizontalAlignment</span>=<span class="string">&quot;Right&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">VerticalAlignment</span>=<span class="string">&quot;Stretch&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">Width</span>=<span class="string">&quot;5&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">Rectangle</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">Cursor</span>=<span class="string">&quot;SizeNS&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">Fill</span>=<span class="string">&quot;Transparent&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">Grid.Row</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">HorizontalAlignment</span>=<span class="string">&quot;Stretch&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">VerticalAlignment</span>=<span class="string">&quot;Bottom&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">Grid</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Border</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ControlTemplate.Triggers</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">Trigger</span> <span class="attr">Property</span>=<span class="string">&quot;ResizeMode&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;CanResizeWithGrip&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">Setter</span> <span class="attr">Property</span>=<span class="string">&quot;Visibility&quot;</span> <span class="attr">TargetName</span>=<span class="string">&quot;WindowResizeGrip&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;Visible&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">Trigger</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ControlTemplate.Triggers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ControlTemplate</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Window.Template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Grid</span> <span class="attr">Background</span>=<span class="string">&quot;White&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">TextBlock</span> <span class="attr">Text</span>=<span class="string">&quot;Hello World&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Grid</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Window</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="windows7任务栏变成">Windows7任务栏变成</h2>
<p>  Windows7和Windows 8(在桌面模式下)使用重新设计的任务栏,它们添加了一些 Windows Vista中不具备的几个增强功能。WPF 可以很好地支持这些功能，不会迫使开发人员添加非托管的API调用或依赖于独立程序集。</p>
<p>  WPF 不但为跳转列表(当右击任务栏按钮时显示的列表)提供基本支持，还允许改变应用程序使用的任务栏预览图像和任务栏图标。接下来几节将看到这些特性。</p>
<div class="note info flat"><p>可在定向到 Windows Vista 的应用程序中安全地使用 Windows任务栏特性。用于与增强的Windows7和 Windows8任务栏交互的任何标记或代码在 Windows Vista 上都会安全地被忽略,如果将.NET4作为目标，而且您正在构建可在 WindowsXP 计算机上运行的应用程序，情况同样如此。WPF会简单地忽略不适用的任务栏特性。</p>
</div>
<h3 id="使用跳转列表">使用跳转列表</h3>
<p>  <strong>跳转列表(jump list)是当右击任务栏按钮时弹出的便捷小菜单。为当前正在运行的应用程序以及当前没有运行但具有锁定到任务栏上的按钮的应用程序显示跳转列表。通常，跳转列表为打开属于恰当应用程序的文档提供了一种快速方法</strong>  —— 例如，打开 Word 的最近文档或在Windows Media Player中频繁播放的歌曲。然而，有些程序使用更富创意的方法执行特定于应用程序的任务。</p>
<h4 id="最近文件支持">最近文件支持</h4>
<p>  Windows7和 Windows8中的任务栏为所有基于文档的应用程序添加了跳转列表，前提是将应用程序注册为处理特定的文件类型。例如，在第7章介绍了如何构建单实例应用程序(称为SinglelnstanceApplication)，该应用程序注册为处理.textDoc 文件。当运行该程序并右击其任务栏按钮时，将看到最近打开的文档列表，下图所示。</p>
<center>自动生成的跳转列表</center>
<img src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/20240809215103.png" width="60%"/>
<p>  如果右击跳转列表中的某个最近访问的文档，Windows会加载应用程序的另一个实例，并作为命令行参数传递完整的文档路径。当然，如果这不是所希望的行为，可通过代码进行修改。例如，对于第7章中的单实例应用程序。如果从其跳转列表打开一个文档，新实例会不加通告地将文档路径传递到当前正在运行的应用程序，然后关闭自身。最终结果是同一个应用程序处理所有文档，无论从应用程序内部还是从跳转列表打开均如此</p>
<p>  正如文档所记载的，为得到最近文档支持，必须将应用程序注册为处理相应的文件类型。可以使用两种简便方法完成该工作。第一种方法，可以使用代码为 Windows注册表添加相关细节，如第7章所述。第二种方法，可通过 Windows资源管理器手动完成该工作。下面是完成该工作的简要步骤:</p>
<ol>
<li>右击恰当的文件（例如，具有*.testDoc*扩展名的文件）</li>
<li>选择<em>Open With|Choose Default Program</em>菜单项以显示<em>Open With</em>对话框</li>
<li>单击<em>Browser</em>按钮，查找WPF应用程序的.exe文件并选择该文件</li>
<li>可酌情禁用<em>Always use selected program to open this kind of file</em>选项。您的应用程序不需要称为具有跳转列表支持的默认应用程序。</li>
<li>单击<em>OK</em>按钮</li>
</ol>
<p>  当注册文件类型时，需要牢记以下几条指导原则：</p>
<ul>
<li>当创建文件类型注册时，为 Windows提供可执行程序的准确路径。所以应在将应用程序放置到某个合理的位置之后再进行注册，否则每次移动了应用程序文件之后都需要重新注册。</li>
<li>不用担心会取代通用文件类型。只要不使应用程序成为该文件类型的默认处理程序，就不会改变 Windows 的工作方式。例如，将您的应用程序注册为处理.txt 文件是完全可以接受的。这样，当用户使用指定的应用程序打开一个.xt文件时，该文件显示在应用程序的最近文档列表中。类似地，如果用户从指定的应用程序的跳转列表中选择一个文档Windows 会加载您的应用程序。然而，如果在 Windows 资源管理器中双击.txt 文件Windows 仍会为.xt 文件启动默认的应用程序(通常是记事本)。</li>
<li>为在 Visual Studio 中测试跳转列表，必须关闭运行 VisualStudio 承载进程。如果正在运行Visual Studio，Windows 将为承载进程(YourApp.vshost.exe)检查文件类型注册，而不是为您的应用程序(YourApp.exe)检査文件类型注册。为避免该问题，直接从 Windows 资源管理器或选择 Debug|Start Without Debugging 菜单项来运行编译过的应用程序。对于任意一种方法，当测试跳转列表时都不会得到调试支持。</li>
</ul>
<p>  Windows 不但为您的应用程序方便地提供最近文档列表，而且还支持锁定(pinning)，锁定允许用户将他们最重要的文档附加到跳转列表中并永远保留它们。与所有其他应用程序的跳转列表相同，用户可通过单击小的缩略图标来锁定文档。Windows然后将选择的文件移到单独的列表类别中，这就是所谓的锁定。类似地，用户可通过右击并选择Remove 来将一个项从最近文档列表中删除。</p>
<h4 id="自定义跳转列表">自定义跳转列表</h4>
<p>  您到目前为止看到的跳转列表支持被构建进了Windows，并且不需要任何 WPF 逻辑。然而，WPF通过允许控制跳转列表并且允许填充自定义项，添加了对跳转列表的支持。为此，只需要在 App.xaml 文件中添加一些定义&lt;JumpList.List&gt;节点的标记，如下所示:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Application</span></span></span><br><span class="line"><span class="tag">    <span class="attr">StartupUri</span>=<span class="string">&quot;MainWindow.xaml&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">x:Class</span>=<span class="string">&quot;WpfApp.App&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns</span>=<span class="string">&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:x</span>=<span class="string">&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">JumpList.JumpList</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">JumpList</span> <span class="attr">ShowRecentCategory</span>=<span class="string">&quot;True&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">JumpPath</span> <span class="attr">CustomCategory</span>=<span class="string">&quot;Sample Documents&quot;</span> <span class="attr">Path</span>=<span class="string">&quot;c:\samples\samples.testdoc&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">JumpTask</span></span></span><br><span class="line"><span class="tag">                <span class="attr">ApplicationPath</span>=<span class="string">&quot;c:\windows\notepad.exe&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">Arguments</span>=<span class="string">&quot; c:\samples\samples.testdoc &quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">CustomCategory</span>=<span class="string">&quot;Other Programs&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">Description</span>=<span class="string">&quot;Open a sample document in Notepad&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">IconResourcePath</span>=<span class="string">&quot;c:\windows\notepad.exe&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">Title</span>=<span class="string">&quot;Notepad&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">JumpList</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">JumpList.JumpList</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">Application</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>  当采用这种方式定义定制的跳转列表时，Windows停止显示最近文档列表。为使Windows继续显示最近文档列表，需要使用 <code>JumpList.ShowRecentCategory</code>属性明确地进行选择。还可添加 <code>ShowFrequentCategory</code> 属性，以便为那些注册应用程序处理的最频繁打开的文档显示跳转列表。</p>
<p>  当创建 JumpPath 对象时，可提供两个细节。CustomCategory 属性设置在跳转列表中的项之前显示的标题(如果添加了几个具有相同类别名的项，它们将被分组到一起)。如果没有提供类别，Windows 使用名为 Tasks 的类别。Path 属性是指向文档的文件路径。路径必须是完全限定的文件名，文件必须存在，并且必须是应用程序注册处理的文件类型。如果违反这些规则，就不会在跳转列表中显示指定的项。</p>
<center>JumpTask类的属性</center>
<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Title</td>
<td>在跳转列表中显示的文本</td>
</tr>
<tr>
<td>Description</td>
<td>当将鼠标悬停在项上时显示的工具提示文本</td>
</tr>
<tr>
<td>ApplicationPath</td>
<td>应用程序的可执行文件。与JumpList中的文档路径一样，ApplicationPath属性需要完全限定的路径</td>
</tr>
<tr>
<td>IconResourcePath</td>
<td>指向具有缩略图图标的文件，Windows将在跳转列表中该项的旁边显示该图标。说来也怪，Windows不是选择默认图标,也不是从应用程序的可执行文件中提取图标。如果希望看到有效的图标，就必须设置IconResourcePath属性</td>
</tr>
<tr>
<td>IconResourceIndex</td>
<td>如果 lconResourccPat 指定的应用程序或图标资源有多个图标，那么还需要使用lconResourceImdexed 来选择希望使用的图标</td>
</tr>
<tr>
<td>WorkingDirectory</td>
<td>应用程序将开始启动的工作目录，通常是包含应用程序文档的文件夹</td>
</tr>
<tr>
<td>ApplicationPath</td>
<td>希望传递到应用程序的命令行参数，如打开的文件</td>
</tr>
</tbody>
</table>
<h4 id="使用代码创建跳转列表项">使用代码创建跳转列表项</h4>
<p>  尽管在 App.xaml文件中使用标记填充跳转列表很容易，但这种方法存在严重缺陷。正如您已经看到的，JumpPath 和JumpTask项都需要完全限定的文件路径。然而，该信息通常取决于应用程序的部署方式，从而不应当为其使用硬编码。为此，通常使用代码创建或修改应用程序跳转列表。</p>
<p>  **为使用代码配置跳转列表，使用System.Windows.Shell名称空间中的JumpList、JumpPath以及 JumpTask 类。**下面的示例通过创建新的 JumpPath 对象演示了这种技术。使用该项，用户可打开记事本，查看存储在当前应用程序的文件夹中的readme.txt 文件(不考虑其安装位置)。</p>
<center>具有自定义JumpTask对象的跳转列表</center>
<img src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/20240810101044.png" width="60%"/>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">App_OnStartup</span>(<span class="params"><span class="built_in">object</span> sender, StartupEventArgs e</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Retrieve the current jump list.</span></span><br><span class="line">    JumpList jumpList = <span class="keyword">new</span> JumpList();</span><br><span class="line">    JumpList.SetJumpList(Application.Current, jumpList);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add a new JumpPath for a file in the application folder.</span></span><br><span class="line">    <span class="built_in">string</span> path = Path.GetDirectoryName(</span><br><span class="line">        System.Reflection.Assembly.GetExecutingAssembly().Location</span><br><span class="line">    );</span><br><span class="line">    path = Path.Combine(path, <span class="string">&quot;readme.txt&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (File.Exists(path))</span><br><span class="line">    &#123;</span><br><span class="line">        JumpTask jumpTask = <span class="keyword">new</span> JumpTask();</span><br><span class="line">        jumpTask.CustomCategory = <span class="string">&quot;Documentation&quot;</span>;</span><br><span class="line">        jumpTask.Title = <span class="string">&quot;Read the readme.txt&quot;</span>;</span><br><span class="line">        jumpTask.ApplicationPath = <span class="string">@&quot;c:\windows\notepad.exe&quot;</span>;</span><br><span class="line">        jumpTask.IconResourcePath = <span class="string">@&quot;c:\windows\notepad.exe&quot;</span>;</span><br><span class="line">        jumpTask.Arguments = path;</span><br><span class="line">        jumpList.JumpItems.Add(jumpTask);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update the jump list.</span></span><br><span class="line">    jumpList.Apply();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="从跳转列表启动应用程序任务">从跳转列表启动应用程序任务</h4>
<p>  为使用跳转列表触发任务，需要使用在第7章中使用的单实例技术的变体。这不是WPF跳转列表类中的疏忽–跳转列表就是这么设计的。下面是基本策略:</p>
<ul>
<li>当引发 Application.Startup 事件时，创建指向应用程序的JumpTask 对象。不是使用文件名，而是将 Arguments 属性设置为应用程序识别的特殊编码。例如，如果希望该任务向应用程序传递一条“startorder”指令，可将该属性设置为@#StartOrder。</li>
<li>使用第 7 章中的单实例代码。当启动第二个实例时，向第一个实例传递命令行参数，并关闭新的应用程序。</li>
<li>当第一个实例(在 OnStartupNextInstance( )方法中)接收到命令行参数时，执行适当的<br>
任务。</li>
<li>当引发 Application.Exit 事件时，务必从跳转列表中删除任务，除非当应用程序第一次启动时，任务命令能够同样很好地工作。</li>
</ul>
<h3 id="改变任务栏图标和预览">改变任务栏图标和预览</h3>
<p>  Windows7和 Windows8中的任务栏增加了几个更精致的改进之处，包括可选的进度显示和缩略预览窗口。幸运的是，WPF 使得使用所有这些功能都很容易。</p>
<p>  为访问这些功能中的任意一个，需要使用 TaskbarltemInfo类，该类与前面分析的跳转列表类一样，也位于 System.Windows.Shell 名称空间中。每个窗口都有一个关联的 TaskbarltemInfo对象，并且可通过为窗口添加下面的标记来使用XAML创建该对象:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Window</span></span></span><br><span class="line"><span class="tag">    <span class="attr">Height</span>=<span class="string">&quot;375&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">Title</span>=<span class="string">&quot;MainWindow&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">Width</span>=<span class="string">&quot;450&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">x:Class</span>=<span class="string">&quot;WpfApp.MainWindow&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns</span>=<span class="string">&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:local</span>=<span class="string">&quot;clr-namespace:WpfApp.ViewModels&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:x</span>=<span class="string">&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Window.TaskbarItemInfo</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">TaskbarItemInfo</span> <span class="attr">x:Name</span>=<span class="string">&quot;taskBarItem&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Window.TaskbarItemInfo</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Window</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>  就其本身而言，这一步没有改变窗口或应用程序中的任何内容，但是现在已经准备好使用后面将要演示的特性了。</p>
<h4 id="缩略图裁剪">缩略图裁剪</h4>
<p>  与 Windows 为所有应用程序自动支持跳转列表很相似，WPF还提供了当用户将鼠标悬停在任务栏按钮上时会显示的缩略图预览窗口。通常，缩略图预览窗口显示窗口客户区(除窗口边框之外的所有内容)的缩小版。然而在某些情况下，可能希望只显示窗口的一部分。这种方式的优点是可以只关注窗口中的相关部分。在特大窗口中，这可能是合理的，否则内容会太小而无法阅读。</p>
<p>  可使用 TaskbarltemInfo.ThumbnailClipMargin属性使用该功能。该属性指定 Thickness 对象,设置希望在缩略图中显示的内容和窗口边缘之间的空间。下图显示的示例演示了其工作原理。每次用户单击应用程序中的一个按钮时，就将剪裁区域转换为仅包含被单击按钮的区域。</p>
<img src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/20240810102445.png" width="60%"/>
<p>  为创建该效果，代码必须考虑几个细节:按钮的坐标、尺寸以及窗口内容区域的尺寸(窗口内容区域的尺寸也就是顶级的名为 LayoutRoot的 Grid 面板的尺寸，这很有帮助，该 Grid 面板位于窗口的内部并且包含其所有标记)。一旦具备这些数值，为了仅在正确的区域预览所需的内容，只需要执行几个简单计算:</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">cmdShrinkPreview_Click</span>(<span class="params"><span class="built_in">object</span> sender, RoutedEventArgs e</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Find the position of the clicked button, in window coordinates.</span></span><br><span class="line">    Button cmd = (Button)<span class="keyword">new</span> Button();</span><br><span class="line">    Point locationFromWindow = cmd.TranslatePoint(<span class="keyword">new</span> Point(<span class="number">0</span>, <span class="number">0</span>), <span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Determine the width that should be added to every side.</span></span><br><span class="line">    <span class="built_in">double</span> left = locationFromWindow.X;</span><br><span class="line">    <span class="built_in">double</span> top = locationFromWindow.Y;</span><br><span class="line">    <span class="built_in">double</span> right = LayoutRoot.ActualWidth - cmd.ActualWidth - left;</span><br><span class="line">    <span class="built_in">double</span> bottom = LayoutRoot.ActualHeight - cmd.ActualHeight - top;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Apply the clipping</span></span><br><span class="line">    taskBarItem.ThumbnailClipMargin = <span class="keyword">new</span> Thickness(left, top, right, bottom);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="缩略图按钮">缩略图按钮</h4>
<p>  有些应用程序将预览窗口用于完全不同的目的，它们将按钮放到预览下面的小工具栏区域中。Windows媒体播放器就是一例。如果将鼠标悬停在任务栏图标上，将得到包含播放、暂停前进以及后退按钮的预览，从而提供了一种用于控制播放而不需要切换到应用程序本身的便捷方式。</p>
<p>  WPF 支持缩略图按钮——实际上,WPF 使用它们更容易。只需要为 TaskbarltemInfo.ThumbButtonInfos 集合添加一个或多个 ThumbButonInfo 对象即可。每个 ThumbButtonInfo 对象需要一幅图像，使用 ImageSource 属性提供该图像。还可以用 Description 属性添加工具提示文本。然后可通过处理其 Click 事件将按钮关联到应用程序中的某个方法。</p>
<img src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/20240810104049.png" width="60%"/>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Window.TaskbarItemInfo</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">TaskbarItemInfo</span> <span class="attr">x:Name</span>=<span class="string">&quot;taskBarItem&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">TaskbarItemInfo.ThumbButtonInfos</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ThumbButtonInfo</span></span></span><br><span class="line"><span class="tag">                <span class="attr">Click</span>=<span class="string">&quot;cmdPlay_Click&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">Description</span>=<span class="string">&quot;Play&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">ImageSource</span>=<span class="string">&quot;play.png&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ThumbButtonInfo</span></span></span><br><span class="line"><span class="tag">                <span class="attr">Click</span>=<span class="string">&quot;cmdPause_Click&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">Description</span>=<span class="string">&quot;Pause&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">ImageSource</span>=<span class="string">&quot;pause.png&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">TaskbarItemInfo.ThumbButtonInfos</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">TaskbarItemInfo</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Window.TaskbarItemInfo</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>  当应用程序执行不同任务并且进入不同的状态时，有些任务栏按钮可能不适合。幸运的是可使用少数几个有用的属性对任务栏按钮进行管理，下表列出了这些属性：</p>
<center>ThumbButtonInfo类的属性</center>
<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>ImageSource</td>
<td>设置希望为按钮显示的图像，该图像必须作为资源嵌入到应用程序中。理想情况是，使用具有透明背景的.png文件</td>
</tr>
<tr>
<td>Description</td>
<td>设置当鼠标悬停在按钮上时显示的工具提示文本</td>
</tr>
<tr>
<td>Command CommandParameter CommandTarget</td>
<td>指定按钮应当触发的命令。可使用这些属性，而不使用Click事件</td>
</tr>
<tr>
<td>Visibility</td>
<td>用于隐藏或显示按钮</td>
</tr>
<tr>
<td>IsEnabled</td>
<td>用于禁用按钮，使按钮可见当不能单击</td>
</tr>
<tr>
<td>IsInteractive</td>
<td>用于禁用按钮并且不会使外观变暗。如果希望按钮就像时某种状态指示器，这很有用</td>
</tr>
<tr>
<td>IsBackgroundVisible</td>
<td>用于为按钮禁用悬停反馈。如果为true(默认值)，当将鼠标移动按钮上时，Windows会突出显示按钮并显示其周围的边框，如果为false，就不显示</td>
</tr>
<tr>
<td>DismissWhenClicked</td>
<td>用于创建只使用一次的按钮。只要单击按钮，Windows就会将其成任务栏中移除（为了加强控制，可使用代码随时添加或移除按钮，但使用Visibility属性显示和隐藏按钮通常更容易）</td>
</tr>
</tbody>
</table>
<h4 id="进度通知">进度通知</h4>
<p>  如果在 Windows 资源管理器中复制过大文件,那么应当看到过如何使用进度通知将任务栏按钮的背景着色为绿色。当进行复制时，绿色背景从左向右地填充按钮区域，就像是进度条，直到操作完成为止。</p>
<p>  您可能没有意识到，该特性不仅仅特定于 Windows资源管理器。反而，该特征被构建进了Windows7中，并且所有WPF应用程序都可以使用该特性。需要做的全部工作就是使用TaskbarItemInfo类的两个属性:ProgressValue和ProgressState.</p>
<p>  <strong>ProgressState 属性刚开始时被设置为 None，这意味着不显示进度指示器。然而，如果将其设置为 TaskbarltemProgressState.Normal，就会得到 Windows 资源管理器使用的绿色进度背景ProgressValue 属性决定了绿色背景的尺寸，从 0(没有绿色背景)到 1(完整的绿色背景)。例如，将ProgressValue属性设置为0.5，就会用绿色填充任务栏按钮背景的一半。</strong></p>
<p>  TaskbarltemProgressState 枚举提供了几个可能的值,而不仅是 None 和 Normal。可使用 Pause显示黄色背景而不是绿色，使用Error显示红色背景，以及使用Indeterminate显示忽略ProgressValue 属性的持续的、脉冲进度背景。当不知道完成当前任务需要多长时间时(例如，当调用 Web 服务时)，最后一个选项是合适的。</p>
<h4 id="重叠图标">重叠图标</h4>
<p>  Windows提供的最后一个任务栏特性是任务栏重叠–在任务图标上添加小图像的能力。例如，Messenger聊天程序使用不同的重叠图标指示不同状态。</p>
<p>  为使用重叠图标，只需要一个很小的具有透明背景的.png或.ico 文件。不强制使用特定的像素尺寸，但显然希望图像比任务栏按钮图片更小一点。假定已为项目添加了该图像，可通过简单地设置 TaskbarItemInfo.Overlay属性进行显示。通常，将使用已在标记中定义的图像资源对其进行设置，如下所示:</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">taskBarItem.Overlay = (ImageSource)<span class="keyword">this</span>.FindResource(<span class="string">&quot;WorkingImage&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>  作为一种选择，可使用熟悉的pack URI语法指向嵌入的文件，如下所示：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">taskBarItem.Overlay = <span class="keyword">new</span> BitmapImage(<span class="keyword">new</span> Uri(<span class="string">&quot;pack://applicationL,,,/working.png&quot;</span>));</span><br></pre></td></tr></table></figure>
<p>  将 Overlay 属性设置为空引用会彻底移除重叠图标，下图显示的pause.png图像被用作通用WPF应用程序图标上面的重叠图标，这指示当前暂停了应用程序的工作。</p>
<img src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/20240810111225.png" width="60%"/>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://bootree.cn">大白</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://bootree.cn/2024/08/08/WPF%E7%BC%96%E7%A8%8B%E5%AE%9D%E5%85%B8/23%E7%AA%97%E5%8F%A3/">http://bootree.cn/2024/08/08/WPF%E7%BC%96%E7%A8%8B%E5%AE%9D%E5%85%B8/23%E7%AA%97%E5%8F%A3/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://bootree.cn" target="_blank">生活中的tree</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/WPF%E7%BC%96%E7%A8%8B%E5%AE%9D%E5%85%B8/">WPF编程宝典</a></div><div class="post_share"><div class="social-share" data-image="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/wpf.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://jsd.012700.xyz/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://jsd.012700.xyz/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src= "/img/loading.gif" data-lazy-src="/img/wechat.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src= "/img/loading.gif" data-lazy-src="/img/alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/08/10/WPF%E7%BC%96%E7%A8%8B%E5%AE%9D%E5%85%B8/24%E9%A1%B5%E9%9D%A2%E5%92%8C%E5%AF%BC%E8%88%AA/" title="WPF编程宝典- 24页面和导航"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/wpf.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">WPF编程宝典- 24页面和导航</div></div></a></div><div class="next-post pull-right"><a href="/2024/08/04/WPF%E7%BC%96%E7%A8%8B%E5%AE%9D%E5%85%B8/22%E5%88%97%E8%A1%A8%E3%80%81%E6%A0%91%E5%92%8C%E7%BD%91%E6%A0%BC/" title="WPF编程宝典 - 22列表、树和网格"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/wpf.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">WPF编程宝典 - 22列表、树和网格</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2024/05/23/WPF%E7%BC%96%E7%A8%8B%E5%AE%9D%E5%85%B8/02XAML/" title="WPF编程宝典 - 02XAML"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/20240527195528.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-23</div><div class="title">WPF编程宝典 - 02XAML</div></div></a></div><div><a href="/2024/05/22/WPF%E7%BC%96%E7%A8%8B%E5%AE%9D%E5%85%B8/01%E6%A6%82%E8%BF%B0/" title="WPF编程宝典 - 01概述"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/wpf.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-22</div><div class="title">WPF编程宝典 - 01概述</div></div></a></div><div><a href="/2024/05/24/WPF%E7%BC%96%E7%A8%8B%E5%AE%9D%E5%85%B8/03%E5%B8%83%E5%B1%80/" title="WPF编程宝典 - 03布局"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/20240527195817.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-24</div><div class="title">WPF编程宝典 - 03布局</div></div></a></div><div><a href="/2024/05/25/WPF%E7%BC%96%E7%A8%8B%E5%AE%9D%E5%85%B8/04%E4%BE%9D%E8%B5%96%E5%B1%9E%E6%80%A7/" title="WPF编程宝典 - 04依赖属性"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/wpf.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-25</div><div class="title">WPF编程宝典 - 04依赖属性</div></div></a></div><div><a href="/2024/05/29/WPF%E7%BC%96%E7%A8%8B%E5%AE%9D%E5%85%B8/06%E6%8E%A7%E4%BB%B6/" title="WPF编程宝典 - 06控件"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/wpf.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-29</div><div class="title">WPF编程宝典 - 06控件</div></div></a></div><div><a href="/2024/05/28/WPF%E7%BC%96%E7%A8%8B%E5%AE%9D%E5%85%B8/05%E8%B7%AF%E7%94%B1%E4%BA%8B%E4%BB%B6/" title="WPF编程宝典 - 05路由事件"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/wpf.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-28</div><div class="title">WPF编程宝典 - 05路由事件</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "/img/loading.gif" data-lazy-src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">大白</div><div class="author-info__description">知足而上进，温柔且坚定</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">115</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">20</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">26</div></a></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/cnlicm"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/cnlicm" rel="external nofollow noreferrer" target="_blank" title="Github"><i class="fab fa-github" style="color: #hdhfbb;"></i></a><a class="social-icon" href="mailto:codenobugs@foxmail.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #000000;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">A lazy guy. My dream is that generate electricity with love.</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#window%E7%B1%BB"><span class="toc-number">1.</span> <span class="toc-text">Window类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%BE%E7%A4%BA%E7%AA%97%E5%8F%A3"><span class="toc-number">1.1.</span> <span class="toc-text">显示窗口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%BD%8D%E7%AA%97%E5%8F%A3"><span class="toc-number">1.2.</span> <span class="toc-text">定位窗口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%9D%E5%AD%98%E5%92%8C%E8%BF%98%E5%8E%9F%E7%AA%97%E5%8F%A3%E4%BD%8D%E7%BD%AE"><span class="toc-number">1.3.</span> <span class="toc-text">保存和还原窗口位置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AA%97%E5%8F%A3%E4%BA%A4%E4%BA%92"><span class="toc-number">2.</span> <span class="toc-text">窗口交互</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AA%97%E5%8F%A3%E6%89%80%E6%9C%89%E6%9D%83"><span class="toc-number">2.1.</span> <span class="toc-text">窗口所有权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E8%AF%9D%E6%A1%86%E6%A8%A1%E5%9E%8B"><span class="toc-number">2.2.</span> <span class="toc-text">对话框模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E7%94%A8%E5%AF%B9%E8%AF%9D%E6%A1%86"><span class="toc-number">2.3.</span> <span class="toc-text">通用对话框</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%9E%E7%9F%A9%E5%BD%A2%E7%AA%97%E5%8F%A3"><span class="toc-number">3.</span> <span class="toc-text">非矩形窗口</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E5%BD%A2%E7%8A%B6%E7%AA%97%E5%8F%A3"><span class="toc-number">3.1.</span> <span class="toc-text">简单形状窗口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B7%E6%9C%89%E5%BD%A2%E7%8A%B6%E5%86%85%E5%AE%B9%E7%9A%84%E9%80%8F%E6%98%8E%E7%AA%97%E5%8F%A3"><span class="toc-number">3.2.</span> <span class="toc-text">具有形状内容的透明窗口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A7%BB%E5%8A%A8%E5%BD%A2%E7%8A%B6%E7%AA%97%E5%8F%A3"><span class="toc-number">3.3.</span> <span class="toc-text">移动形状窗口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%B9%E5%8F%98%E5%BD%A2%E7%8A%B6%E7%AA%97%E5%8F%A3%E7%9A%84%E5%B0%BA%E5%AF%B8"><span class="toc-number">3.4.</span> <span class="toc-text">改变形状窗口的尺寸</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AA%97%E5%8F%A3%E7%9A%84%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6%E6%A8%A1%E6%9D%BF"><span class="toc-number">3.5.</span> <span class="toc-text">窗口的自定义控件模板</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#windows7%E4%BB%BB%E5%8A%A1%E6%A0%8F%E5%8F%98%E6%88%90"><span class="toc-number">4.</span> <span class="toc-text">Windows7任务栏变成</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%B7%B3%E8%BD%AC%E5%88%97%E8%A1%A8"><span class="toc-number">4.1.</span> <span class="toc-text">使用跳转列表</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%80%E8%BF%91%E6%96%87%E4%BB%B6%E6%94%AF%E6%8C%81"><span class="toc-number">4.1.1.</span> <span class="toc-text">最近文件支持</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%B7%B3%E8%BD%AC%E5%88%97%E8%A1%A8"><span class="toc-number">4.1.2.</span> <span class="toc-text">自定义跳转列表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E4%BB%A3%E7%A0%81%E5%88%9B%E5%BB%BA%E8%B7%B3%E8%BD%AC%E5%88%97%E8%A1%A8%E9%A1%B9"><span class="toc-number">4.1.3.</span> <span class="toc-text">使用代码创建跳转列表项</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%8E%E8%B7%B3%E8%BD%AC%E5%88%97%E8%A1%A8%E5%90%AF%E5%8A%A8%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E4%BB%BB%E5%8A%A1"><span class="toc-number">4.1.4.</span> <span class="toc-text">从跳转列表启动应用程序任务</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%B9%E5%8F%98%E4%BB%BB%E5%8A%A1%E6%A0%8F%E5%9B%BE%E6%A0%87%E5%92%8C%E9%A2%84%E8%A7%88"><span class="toc-number">4.2.</span> <span class="toc-text">改变任务栏图标和预览</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%A9%E7%95%A5%E5%9B%BE%E8%A3%81%E5%89%AA"><span class="toc-number">4.2.1.</span> <span class="toc-text">缩略图裁剪</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%A9%E7%95%A5%E5%9B%BE%E6%8C%89%E9%92%AE"><span class="toc-number">4.2.2.</span> <span class="toc-text">缩略图按钮</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9B%E5%BA%A6%E9%80%9A%E7%9F%A5"><span class="toc-number">4.2.3.</span> <span class="toc-text">进度通知</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E5%8F%A0%E5%9B%BE%E6%A0%87"><span class="toc-number">4.2.4.</span> <span class="toc-text">重叠图标</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/11/09/IDE/Keil/AStyle%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B7%A5%E5%85%B7/" title="AStyle格式化工具"><img src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/20241109172550.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="AStyle格式化工具"/></a><div class="content"><a class="title" href="/2024/11/09/IDE/Keil/AStyle%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B7%A5%E5%85%B7/" title="AStyle格式化工具">AStyle格式化工具</a><time datetime="2024-11-09T09:23:21.000Z" title="发表于 2024-11-09 17:23:21">2024-11-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/11/09/IDE/Rider/JetBrainsRider%E6%8F%92%E4%BB%B6%E6%B1%87%E6%80%BB/" title="JetBrainsRider插件汇总"><img src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/20240902145915.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JetBrainsRider插件汇总"/></a><div class="content"><a class="title" href="/2024/11/09/IDE/Rider/JetBrainsRider%E6%8F%92%E4%BB%B6%E6%B1%87%E6%80%BB/" title="JetBrainsRider插件汇总">JetBrainsRider插件汇总</a><time datetime="2024-11-09T09:21:50.000Z" title="发表于 2024-11-09 17:21:50">2024-11-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/11/09/IDE/Rider/JetBrainsRider%E5%BF%AB%E6%8D%B7%E9%94%AE/" title="JetBrainsRider快捷键"><img src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/20240902145915.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JetBrainsRider快捷键"/></a><div class="content"><a class="title" href="/2024/11/09/IDE/Rider/JetBrainsRider%E5%BF%AB%E6%8D%B7%E9%94%AE/" title="JetBrainsRider快捷键">JetBrainsRider快捷键</a><time datetime="2024-11-09T09:18:55.000Z" title="发表于 2024-11-09 17:18:55">2024-11-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/10/21/Circuits/PcbDesign/02%E5%98%89%E7%AB%8B%E5%88%9BEDA%E4%BD%BF%E7%94%A8/" title="02嘉立创EDA使用"><img src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/20241020174157.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="02嘉立创EDA使用"/></a><div class="content"><a class="title" href="/2024/10/21/Circuits/PcbDesign/02%E5%98%89%E7%AB%8B%E5%88%9BEDA%E4%BD%BF%E7%94%A8/" title="02嘉立创EDA使用">02嘉立创EDA使用</a><time datetime="2024-10-21T12:08:46.000Z" title="发表于 2024-10-21 20:08:46">2024-10-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/10/20/Circuits/PcbDesign/01PCB%E7%AE%80%E4%BB%8B/" title="01PCB简介"><img src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/20241020174157.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="01PCB简介"/></a><div class="content"><a class="title" href="/2024/10/20/Circuits/PcbDesign/01PCB%E7%AE%80%E4%BB%8B/" title="01PCB简介">01PCB简介</a><time datetime="2024-10-20T09:40:03.000Z" title="发表于 2024-10-20 17:40:03">2024-10-20</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/wpf.png')"><div id="footer-wrap"><div class="copyright">&copy;2024 By 大白</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><a target="_blank" rel="noopener external nofollow noreferrer" href="https://beian.miit.gov.cn/"><img class="icp-icon" src= "/img/loading.gif" data-lazy-src="/img/2020011362.png"><span>赣ICP备2020011362号-2</span></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="https://jsd.012700.xyz/npm/hexo-theme-butterfly@4.13.0/source/js/utils.min.js"></script><script src="https://jsd.012700.xyz/npm/hexo-theme-butterfly@4.13.0/source/js/main.min.js"></script><script src="https://jsd.012700.xyz/npm/hexo-theme-butterfly@4.13.0/source/js/tw_cn.min.js"></script><script src="https://jsd.012700.xyz/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><script src="https://jsd.012700.xyz/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://jsd.012700.xyz/npm/vanilla-lazyload@17.8.8/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaid.length === 0) return
  const runMermaid = () => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    Array.from($mermaid).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const loadMermaid = () => {
    window.loadMermaid ? runMermaid() : getScript('https://jsd.012700.xyz/npm/mermaid@10.8.0/dist/mermaid.min.js').then(runMermaid)
  }

  btf.addGlobalFn('themeChange', runMermaid, 'mermaid')

  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script data-pjax src="/self/btf.js"></script><script defer="defer" id="ribbon" src="https://jsd.012700.xyz/npm/butterfly-extsrc@1.1.3/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="true" data-click="true"></script><script src="https://jsd.012700.xyz/npm/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"]):not([href="/talking/"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener
  btf.removeGlobalFnEvent('pjax')
  btf.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="https://jsd.012700.xyz/npm/hexo-theme-butterfly@4.13.0/source/js/search/local-search.min.js"></script></div></div></body></html>