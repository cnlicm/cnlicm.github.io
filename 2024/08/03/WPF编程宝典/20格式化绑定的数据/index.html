<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>WPF编程宝典 - 20格式化绑定的数据 | 生活中的tree</title><meta name="author" content="大白"><meta name="copyright" content="大白"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="数据转换&emsp;&emsp;在基本绑定中，信息在从源到目标的传递过程中没有任何变化。这看起来是符合逻辑的，但我们并不总是希望出现这种行为。通常，数据源使用的是低级表达方式，我们可能不希望直接在用户界面中使用这种低级表达方式。例如，可能希望使用更便于读取的字符串来代替数字编码，数字需要被削减到合适的尺寸，日期需要使用长格式显示等。如果是这样的话，就需要有一种方法将这些数值转换为恰当的显示形式。并">
<meta property="og:type" content="article">
<meta property="og:title" content="WPF编程宝典 - 20格式化绑定的数据">
<meta property="og:url" content="http://bootree.cn/2024/08/03/WPF%E7%BC%96%E7%A8%8B%E5%AE%9D%E5%85%B8/20%E6%A0%BC%E5%BC%8F%E5%8C%96%E7%BB%91%E5%AE%9A%E7%9A%84%E6%95%B0%E6%8D%AE/index.html">
<meta property="og:site_name" content="生活中的tree">
<meta property="og:description" content="数据转换&emsp;&emsp;在基本绑定中，信息在从源到目标的传递过程中没有任何变化。这看起来是符合逻辑的，但我们并不总是希望出现这种行为。通常，数据源使用的是低级表达方式，我们可能不希望直接在用户界面中使用这种低级表达方式。例如，可能希望使用更便于读取的字符串来代替数字编码，数字需要被削减到合适的尺寸，日期需要使用长格式显示等。如果是这样的话，就需要有一种方法将这些数值转换为恰当的显示形式。并">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/wpf.png">
<meta property="article:published_time" content="2024-08-03T01:49:51.000Z">
<meta property="article:modified_time" content="2024-09-20T15:30:57.351Z">
<meta property="article:author" content="大白">
<meta property="article:tag" content="WPF编程宝典">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/wpf.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://bootree.cn/2024/08/03/WPF%E7%BC%96%E7%A8%8B%E5%AE%9D%E5%85%B8/20%E6%A0%BC%E5%BC%8F%E5%8C%96%E7%BB%91%E5%AE%9A%E7%9A%84%E6%95%B0%E6%8D%AE/index.html"><link rel="preconnect" href="https://jsd.012700.xyz"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="NdIUXAOVyGnnBhcrip0ksCawbdAzT0hlBZDE9u4jx6k"/><meta name="msvalidate.01" content="567E47D75E8DCF1282B9623AD914701E"/><meta name="baidu-site-verification" content="code-pE5rnuxcfD"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://jsd.012700.xyz/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://jsd.012700.xyz/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":400},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":150,"languages":{"author":"作者: 大白","link":"链接: ","source":"来源: 生活中的tree","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://jsd.012700.xyz/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'WPF编程宝典 - 20格式化绑定的数据',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-09-20 23:30:57'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="preconnect" href="https://jsd.012700.xyz"><link href="/self/btf.css" rel="stylesheet"><link rel="alternate" href="/atom.xml" title="生活中的tree" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "/img/loading.gif" data-lazy-src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">67</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">17</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">20</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首頁</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fas fa-compass"></i><span> 目录</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fa fa-heartbeat"></i><span> 娱乐</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 图库</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/wpf.png')"><nav id="nav"><span id="blog-info"><a href="/" title="生活中的tree"><span class="site-name">生活中的tree</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首頁</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fas fa-compass"></i><span> 目录</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fa fa-heartbeat"></i><span> 娱乐</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 图库</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">WPF编程宝典 - 20格式化绑定的数据<a class="post-edit-link" href="https://github.com/cnlicm/HexoBlog/tree/main/source/_posts/WPF编程宝典/20格式化绑定的数据.md" rel="external nofollow noreferrer" title="编辑" target="_blank"><i class="fas fa-pencil-alt"></i></a></h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">发表于</span><time datetime="2024-08-03T01:49:51.000Z" title="发表于 2024-08-03 09:49:51">2024-08-03</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/C/">C#</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/C/WPF/">WPF</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">10.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>41分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="WPF编程宝典 - 20格式化绑定的数据"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="数据转换"><a href="#数据转换" class="headerlink" title="数据转换"></a>数据转换</h2><p>&emsp;&emsp;在基本绑定中，信息在从源到目标的传递过程中没有任何变化。这看起来是符合逻辑的，但我们并不总是希望出现这种行为。通常，数据源使用的是低级表达方式，我们可能不希望直接在用户界面中使用这种低级表达方式。例如，可能希望使用更便于读取的字符串来代替数字编码，数字需要被削减到合适的尺寸，日期需要使用长格式显示等。如果是这样的话，就需要有一种方法将这些数值转换为恰当的显示形式。并且如果正在使用双向绑定，还需要进行反向转换--获取用户提供的数据并将它们转换到适于在恰当的数据对象中保存的表示形式。<br>&emsp;&emsp;幸运的是，WPF提供了两个工具，可提供帮助：</p>
<ul>
<li><strong>字符串格式化</strong>。使用该功能个通过设置<code>Binding.StringFormat</code>属性对文本形式的数据进行转换——<em>例如包含日期和数值的字符串</em>。对于至少一般的格式化任务，字符串格式化是一种便捷的技术</li>
<li><strong>值转换器</strong>。该功能更强大（有时更复杂），使用该功能可将任意类型的源数据转换为任意类型的对象表示，然后个传递到关联的控件。</li>
</ul>
<h3 id="使用StringFormat属性"><a href="#使用StringFormat属性" class="headerlink" title="使用StringFormat属性"></a>使用StringFormat属性</h3><p>&emsp;&emsp;为格式化需要显示的文本的数字，字符串格式化堪称完美工具。当设置<code>Binding.StringFormat</code>属性时，使用标准的.NET格式化字符串。</p>
<blockquote>
<p>显示货币格式，0代表第一个数值，C应用希望应用的格式字符串——对于这个示例，它是标准的本地专用的货币格式</p>
</blockquote>
<img src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/20240803101816.png"/>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">TextBlock</span> <span class="attr">Text</span>=<span class="string">&quot;&#123;Binding UnitCost, StringFormat=&#123;&#125;&#123;0:C&#125;&#125;&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<div class="note warning flat"><p>&emsp;&emsp;<code>StringFormat</code>属性的值以花括号<code>{}</code>开头。完整值是<code>{}{0:C}</code>而不是*{0:C}*，为了转义字符串，需要在开始初使用稍微笨拙的花括号对。否则，XAML解析器可能会被{0:C}开头的花括号说迷惑</p>
</div>

<p>&emsp;&emsp;只有当<code>StringFormat</code>值以花括号开头时才需要<code>&#123;&#125;</code>转义序列。例如下面的示例，在格式化数值之前添加了一个字面文本序列，因此不需要添加<code>&#123;&#125;</code>开头进行转义。</p>
<img src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/20240803102514.png"/>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">TextBlock</span> <span class="attr">Text</span>=<span class="string">&quot;&#123;Binding UnitCost, StringFormat=The value is &#123;0:C&#125;&#125;&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;<em>这个表达式将值(如 999.99)转换成“The value is $999.99.”。因为 StringFormat属性值中的第个字符是普通字母，不是括号，所以在开头不需要初始化转义序列。</em> 然而，<strong>这个格式字符串只能在一个方向上工作。</strong>如果用户试图提供包含该字面文本的编辑过的值(如“The value is $4.25.”)，更新会失败。而另一方面，如果用户为只有数字字符(4.25)或具有数字字符和货币符号($4.25)的数值执行编辑，编辑就会成功，绑定表达式将其转换为显示文本“Thevalueis$4.25.”，并在文本框中显示该文本。</p>
<center>数值数据的格式字符串</center>

<table>
<thead>
<tr>
<th>类型</th>
<th>格式字符串</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>货币</td>
<td>C</td>
<td>$999.99，货币符号特定于区域</td>
</tr>
<tr>
<td>科学计数法(指数)</td>
<td>E</td>
<td>1234.50E+004</td>
</tr>
<tr>
<td>百分数</td>
<td>P</td>
<td>45.6%</td>
</tr>
<tr>
<td>固定小数</td>
<td>F?</td>
<td>取决于设置的小数位数，F3格式化数值类似与123.400，F0格式化数值类似于123</td>
</tr>
</tbody></table>
<center>时间和日期数据的格式字符串</center>

<table>
<thead>
<tr>
<th>类型</th>
<th>格式字符串</th>
<th>格式</th>
</tr>
</thead>
<tbody><tr>
<td>短日期</td>
<td>d</td>
<td>M&#x2F;d&#x2F;yyy 例如09&#x2F;08&#x2F;2024</td>
</tr>
<tr>
<td>长日期</td>
<td>D</td>
<td>dddd,MMMM,dd,yyyy 例如：Staurday,August 03,2024</td>
</tr>
<tr>
<td>长日期和短时间</td>
<td>f</td>
<td>dddd,MMMM,dd,yyyy HH:mm aa 例如：Staurday,August 03,2024 10:17 AM</td>
</tr>
<tr>
<td>长日期和长时间</td>
<td>f</td>
<td>dddd,MMMM,dd,yyyy HH:mm:ss aa 例如：Staurday,August 03,2024 10:17:14 AM</td>
</tr>
<tr>
<td>ISO Sortable标准</td>
<td>s</td>
<td>yyyy-MM-dd HH:mm:ss 例如：2024-08-03 10:17:14</td>
</tr>
<tr>
<td>月和日</td>
<td>M</td>
<td>MMMM dd 例如：August 03</td>
</tr>
<tr>
<td>通用格式</td>
<td>G</td>
<td>M&#x2F;d&#x2F;yyyy HH:mm:ss aa(取决于特定区域设置) 例如：03&#x2F;08&#x2F;2024 10:17:14 AM</td>
</tr>
</tbody></table>
<p>&emsp;&emsp;WPF列表控件还支持针对列表项的字符串格式化。为使用这种格式化，只需要设置列表的<code>ItemStringFormat</code>属性(该属性继承自<em>ItemsControl</em>基类)</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ListBox</span> <span class="attr">x:Name</span>=<span class="string">&quot;lstProducts&quot;</span> <span class="attr">DisplayMemberPath</span>=<span class="string">&quot;UnitCode&quot;</span> <span class="attr">ItemStringFormat</span>=<span class="string">&quot;&#123;0:C&#125;&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="值转换器"><a href="#值转换器" class="headerlink" title="值转换器"></a>值转换器</h3><p>&emsp;&emsp;<code>Binding.StringFormat</code>属性时针对简单的、标准的格式化数字和日期而创建的。当许多数据绑定需要更强大的工具，称为**值转换器(value converter)**类。</p>
<p>&emsp;&emsp;值转换器的作用显而易见。它负责在目标中显示数据之前转换源数据，并且（对于双向绑定）在将数据应用回源之前转换新的目标值。值转换器是WPF数据绑定难题中非常有用的一部分。个通过如下几种有用的方式使用它们：</p>
<ul>
<li><strong>将数据格式化为字符串表示形式</strong>。你嘞，个将数字转换成货币字符串。这是值转换器最明显的用途，但当然不是唯一用途</li>
<li><strong>创建特定类型的WPF对象</strong>。例如，个读取一块二进制数据，并创建一幅能绑定到<em>Image</em>元素的<em>BitmappImage</em>对象</li>
<li><strong>根据绑定数据有条件地改变元素中的属性</strong>。例如，个创建值转换器，用于改版了元素的背景色以突出显示位于特定范围内的数值</li>
</ul>
<h3 id="值转换器设置字符串的格式"><a href="#值转换器设置字符串的格式" class="headerlink" title="值转换器设置字符串的格式"></a>值转换器设置字符串的格式</h3><p>&emsp;&emsp;以下示例依然分析格式化货币的示例，尽管使用<code>Binding.StringFormat</code>属性个更简单的完成相同的工作。</p>
<p>&emsp;&emsp;为创建值转换器，需要执行以下步骤：</p>
<ul>
<li>创建一个实现了<code>IValueConverter</code>接口的类。</li>
<li>为该类声明添加<code>ValueConversion</code>特性，并制定目标数据类型。</li>
<li>实现<code>Convert()</code>方法，该方法将数据成原来的格式转换为显示格式。</li>
<li>实现<code>ConvertBack()</code>方法，该方法执行反向变换，将值从显示格式转换为原格式。</li>
</ul>
<center>值转换器的工作原理</center>

<img src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/20240803105455.png"/>

<div class="tabs" id="priceconvetrer"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="priceconvetrer-1">PriceConverter</button><button type="button" class="tab " data-href="priceconvetrer-2">Xaml</button></ul><div class="tab-contents"><div class="tab-item-content active" id="priceconvetrer-1"><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">ValueConversion(typeof(decimal), typeof(string))</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PriceConverter</span> : <span class="title">MarkupExtension</span>, <span class="title">IValueConverter</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">object</span> <span class="title">Convert</span>(<span class="params"><span class="built_in">object</span> <span class="keyword">value</span>, Type targetType, <span class="built_in">object</span> parameter, CultureInfo culture</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">decimal</span> price = (<span class="built_in">decimal</span>)<span class="keyword">value</span>;</span><br><span class="line">        <span class="keyword">return</span> price.ToString(<span class="string">&quot;C&quot;</span>, culture);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">object</span> <span class="title">ConvertBack</span>(<span class="params"><span class="built_in">object</span> <span class="keyword">value</span>, Type targetType, <span class="built_in">object</span> parameter, CultureInfo culture</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">string</span> price = <span class="keyword">value</span>.ToString();</span><br><span class="line">        <span class="built_in">decimal</span> result;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">decimal</span>.TryParse(price, NumberStyles.Any, culture, <span class="keyword">out</span> result))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">value</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">object</span> <span class="title">ProvideValue</span>(<span class="params">IServiceProvider serviceProvider</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 通过Markup语法可以减少代码的书写，还可以通过传统定义转换器资源的方式或定义静态属性通过x:Static绑定使用转换器</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="priceconvetrer-2"><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">Grid</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextBox</span> <span class="attr">Text</span>=<span class="string">&quot;&#123;Binding UnitCost, Converter=&#123;cvt:PriceConverter&#125;&#125;&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Grid</span>&gt;</span></span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div>

<h3 id="值转换器创建对象"><a href="#值转换器创建对象" class="headerlink" title="值转换器创建对象"></a>值转换器创建对象</h3><p>&emsp;&emsp;如果需要填平数据在自定义类中存储的方式和在窗口中显示的方式之间的鸿沟，值转换器是必不可少的。例如，设想具有在数据库的字段中存储为字节数组的图片数据。可将二进制数据转换为 System.Windows.Media.Imaging.BitmapImage 对象，并将该对象存储为自定义数据对象的一部分。然而，这种设计可能不合适。</p>
<div class="note info flat"><p>&emsp;&emsp;要将一块二进制数据转换成一幅图像，首先必须创建 BitmapImage 对象，并将图像数据读入到 MemoryStream 对象中。然后，可调用 Bitmaplmage.BeginInit()方法来设置 Bitmaplmage 对象的StreamSource 属性，使其指向 MemoryStream 对象，并调用 EndInit( )方法来完成图像的加载。</p>
</div>

<blockquote>
<p>以下示例采用简单的图片路径转BitmapImage</p>
</blockquote>
<img src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/20240803112404.png"/>

<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">ValueConversion(typeof(string), typeof(BitmapImage))</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ImagePathConverter</span> : <span class="title">MarkupExtension</span>, <span class="title">IValueConverter</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">string</span> _imageDirectory = Directory.GetCurrentDirectory();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> ImageDirectory</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span> =&gt; _imageDirectory;</span><br><span class="line">        <span class="keyword">set</span> =&gt; _imageDirectory = <span class="keyword">value</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">object</span> <span class="title">Convert</span>(<span class="params"><span class="built_in">object</span> <span class="keyword">value</span>, Type targetType, <span class="built_in">object</span> parameter, CultureInfo culture</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">string</span> imagePath = Path.Combine(ImageDirectory, (<span class="built_in">string</span>)<span class="keyword">value</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BitmapImage(<span class="keyword">new</span> Uri(imagePath));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">object</span> <span class="title">ConvertBack</span>(<span class="params"><span class="built_in">object</span> <span class="keyword">value</span>, Type targetType, <span class="built_in">object</span> parameter, CultureInfo culture</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NotImplementedException();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">object</span> <span class="title">ProvideValue</span>(<span class="params">IServiceProvider serviceProvider</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="应用条件格式化"><a href="#应用条件格式化" class="headerlink" title="应用条件格式化"></a>应用条件格式化</h3><p>&emsp;&emsp;有些有趣的值转换器不是为了显示而格式化数据，而是旨在根据数据规则格式化元素中与外观相关的其他方面。</p>
<blockquote>
<p>例如，设想希望通过不同的背景色标志那些价格高昂的产品项。使用下面的值转换器就能方便地封装这一逻辑：</p>
</blockquote>
<div class="tabs" id="pricetobackgroundconverter"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="pricetobackgroundconverter-1">PriceToBackgroundConverter</button><button type="button" class="tab " data-href="pricetobackgroundconverter-2">Xaml</button></ul><div class="tab-contents"><div class="tab-item-content active" id="pricetobackgroundconverter-1"><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">ValueConversion(typeof(decimal), typeof(Brush))</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PriceToBackgroundConverter</span> : <span class="title">MarkupExtension</span>, <span class="title">IValueConverter</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">decimal</span> MinimumPriceToHeight &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> Brush HighlightBrush &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> Brush DefaultBrush &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">object</span> <span class="title">Convert</span>(<span class="params"><span class="built_in">object</span> <span class="keyword">value</span>, Type targetType, <span class="built_in">object</span> parameter, CultureInfo culture</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">decimal</span> price = (<span class="built_in">decimal</span>)<span class="keyword">value</span>;</span><br><span class="line">        <span class="keyword">if</span> (price &gt;= MinimumPriceToHeight)</span><br><span class="line">            <span class="keyword">return</span> HighlightBrush;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> DefaultBrush;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">object</span> <span class="title">ConvertBack</span>(<span class="params"><span class="built_in">object</span> <span class="keyword">value</span>, Type targetType, <span class="built_in">object</span> parameter, CultureInfo culture</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NotImplementedException();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">object</span> <span class="title">ProvideValue</span>(<span class="params">IServiceProvider serviceProvider</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="pricetobackgroundconverter-2"><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Border</span></span></span><br><span class="line"><span class="tag">    <span class="attr">Background</span>=<span class="string">&quot;&#123;Binding UnitCost, Converter=&#123;cvt:PriceToBackgroundConverter DefaultBrush=&#123;x:Null&#125;, HighlightBrush=Orange, MinimumPriceToHeight=50&#125;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">Height</span>=<span class="string">&quot;100&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">Width</span>=<span class="string">&quot;100&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div>

<h3 id="评估多个属性"><a href="#评估多个属性" class="headerlink" title="评估多个属性"></a>评估多个属性</h3><p>&emsp;&emsp;到目前为止，已经使用绑定表达式将一部分源数据转换成单个格式化的结果。尽管不能修改等式的另一部分(结果)，但是只需要很少的技巧，就可以创建能够评估或结合多个源属性信息的绑定。</p>
<p>&emsp;&emsp;第一个技巧是用 MultiBinding 对象代替 Binding,对象。然后使用 MultiBinding.StringFormat 属性定义绑定属性的排列。下面是一个示例,该例将 Joe 和 Smith 转换为“Smith,Joe”,并在 TextBlock元素中显示结果:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">TextBlock</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextBlock.Text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">MultiBinding</span> <span class="attr">StringFormat</span>=<span class="string">&quot;&#123;1&#125;, &#123;0&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Binding</span> <span class="attr">Path</span>=<span class="string">&quot;FirstName&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Binding</span> <span class="attr">Path</span>=<span class="string">&quot;LastName&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">MultiBinding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">TextBlock.Text</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">TextBlock</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;您可能注意到，这个示例在 StingFormat 属性中使用了两个字段。同样，可使用格式字符串进行修改。例如，如果使用 MultiBinding 结合文本值和货币值,可将 StingFormat 属性设置为“{0} costs {l:C}。”</p>
<p>&emsp;&emsp;如果希望使用两个源字段完成更富有挑战性的工作，而不只是将它们缝合到一起，需要借助于值转换器。可使用这种方法执行计算(例如，将UnitPrice 乘以 UnitsInStock)，或同时使用多个细节进行格式化(例如，突出显示特定目录中的所有高价位产品)。然而对于这种情况，值转换器必须实现 <code>IMultiValueConverter</code>接口，而不是实现IValueConverter 接口。</p>
<img src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/20240803114946.png"/>

<div class="tabs" id="valueinstockconverter"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="valueinstockconverter-1">ValueInStockConverter</button><button type="button" class="tab " data-href="valueinstockconverter-2">Xaml</button></ul><div class="tab-contents"><div class="tab-item-content active" id="valueinstockconverter-1"><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">ValueConversion(typeof(decimal),typeof(string))</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ValueInStockConverter</span> : <span class="title">MarkupExtension</span>, <span class="title">IMultiValueConverter</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">object</span> <span class="title">Convert</span>(<span class="params"><span class="built_in">object</span>[] values, Type targetType, <span class="built_in">object</span> parameter, CultureInfo culture</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">decimal</span> unitCost = (<span class="built_in">decimal</span>)values[<span class="number">0</span>];</span><br><span class="line">        <span class="built_in">int</span> unitsInStock = (<span class="built_in">int</span>)values[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (unitCost * unitsInStock).ToString(<span class="string">&quot;C&quot;</span>,culture);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">object</span>[] <span class="title">ConvertBack</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="built_in">object</span> <span class="keyword">value</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        Type[] targetTypes,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="built_in">object</span> parameter,</span></span></span><br><span class="line"><span class="params"><span class="function">        CultureInfo culture</span></span></span><br><span class="line"><span class="params"><span class="function">    </span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NotImplementedException();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">object</span> <span class="title">ProvideValue</span>(<span class="params">IServiceProvider serviceProvider</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="valueinstockconverter-2"><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">TextBlock</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextBlock.Text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">MultiBinding</span> <span class="attr">Converter</span>=<span class="string">&quot;&#123;cvt:ValueInStockConverter&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Binding</span> <span class="attr">Path</span>=<span class="string">&quot;UnitCost&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Binding</span> <span class="attr">Path</span>=<span class="string">&quot;UnitsInStock&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">MultiBinding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">TextBlock.Text</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">TextBlock</span>&gt;</span></span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div>

<h2 id="列表控件"><a href="#列表控件" class="headerlink" title="列表控件"></a>列表控件</h2><p>&emsp;&emsp;<code>ItemsControl</code>类为封装项列表中的控件定义了基本功能。这些项可以是列表中的项、树中的节点、菜单中的命令、工具栏中的按钮等，下图将要显示了WPF中所有<code>ItemsConrol</code>类的基本情况。</p>
<center>继承自ItemsConrol的类</center>

<img src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/20240803144700.png" width="50%"/>

<p>&emsp;&emsp;<code>ItemsControl</code>类定义了支持数据绑定以及两个重要格式化特性（样式和数据模板）的属性，下表简要总结了支持着两个特性的属性：</p>
<center>ItemsControl类中与格式化相关的属性</center>

<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>ItemsSource</td>
<td>绑定数据源（希望在列表中显示的集合或DataView对象）</td>
</tr>
<tr>
<td>DisplayMemberPath</td>
<td>希望为每个数据项显示的属性。对于更复杂的表达形式或者为了使用多个属性的组合而言，应改用ItemTemplate属性</td>
</tr>
<tr>
<td>ItemStringFormat</td>
<td>该属性时一个.NET格式字符串，如果设置了该属性，将使用该属性为每个项格式化文本。通常，这种技术用于将数字或日期值转换成合适的显示形式</td>
</tr>
<tr>
<td>ItemContainerStyle</td>
<td>该属性时一个样式，通过该样式可以设置封装每个项的容器的多个属性。容器取决于列表类型（例如，对于ListBox类是ListBoxItem，对于ComboBox类是ComboBoxItem）。当填充列表时，自动创建这些封装器对象</td>
</tr>
<tr>
<td>ItemContainerStyleSelector</td>
<td>使用代码为列表中每项的封装器选择样式的StyleSelector对象。可以使用该属性为列表中的不同项提供不同的样式。必须创建自定义的StyleSelector类</td>
</tr>
<tr>
<td>AlternationCount</td>
<td>在数据中设置的交替集合数量。例如，将AlternationCount设置为2，将在两个不同的行样式之间交替。如果将AlternationCount设置为3，将在3个不同的行样式之间交替</td>
</tr>
<tr>
<td>ItemTemplate</td>
<td>此类模板从绑定的对象提取合适的数据，并将提取的数据安排到合适的控件组合中</td>
</tr>
<tr>
<td>ItemTemplateSelector</td>
<td>使用代码为列表中的每个项选择模板的DataTemplateSelector对象。可以通过这个属性为不同的项应用不同的模板。必须创建自定义的DataTemplateSelector类</td>
</tr>
<tr>
<td>ItemsPanel</td>
<td>定义用于包含列表中项的面板。所有项封装器都添加到这个容器中。通常，使用垂直方向（自上而下）的VirtualizingStackPanel面板</td>
</tr>
<tr>
<td>GroupStyle</td>
<td>如果正在使用分组，这个样式定义了应当如何格式化每个分组。当使用分组时，项封装器(ListBoxItemHeComboBoxItem等)被添加到表示每个分组的GroupItem封装器中，然后这些分组被添加到列表中</td>
</tr>
<tr>
<td>GroupStyleSelector</td>
<td>使用代码为每个分组选择样式的StyleSelector对象。可以通过这个属性为不同的分组使用不同的样式。必须创建自定义的StyleSelector类</td>
</tr>
</tbody></table>
<p>&emsp;&emsp;ItemsControl类继承层次中的下一层是 Selector 类,该类为确定并设置选择项添加了一套简单的属性。并不是所有的ItemsControls类都支持选择。例如，对于ToolBar和 Menu 控件，选择就没有任何意义，所以这些类继承自ItemsControl类，而不是继承自Selector类。</p>
<p>&emsp;&emsp;Selector 类添加的属性包括 SelectedItem(选中的数据对象)、SelectedIndex(选中项的位置)以及 SelectedValue(所选数据对象的 value 属性，它是通过设置 SelectedValuePath 属性指定的)。注意,Selector类不支持多项选择--ListBox控件通过它的SelectionMode和 SelectedItems属性(本质上这是 ListBox 类为这个模型添加的所有内容)添加了这一支持。</p>
<h2 id="列表样式"><a href="#列表样式" class="headerlink" title="列表样式"></a>列表样式</h2><p>&emsp;&emsp;本章将集中介绍WPF列表控件提供的两个特性：<strong>样式和数据模板</strong>。在这两个工具中，样式更简单一些（当功能逊色一些）。在许多情况下，个通过它们添加精彩的格式。</p>
<h3 id="ItemContainerStyle"><a href="#ItemContainerStyle" class="headerlink" title="ItemContainerStyle"></a>ItemContainerStyle</h3><p>&emsp;&emsp;因为WPF的数据绑定系统自动生成列表项对象。因此，为单个项应用您所希望的格式不是很容易。解决方案是<code>ItemContainerStyle</code>属性。如果设置了<code>ItemContainerStyle</code>属性，当创建列表项时，列表控件会将其向下传递给每个项。对于ListBox控件，每个项有ListBoxItem对象表示；对于ComboBox控件，每个项由ComboBoxItem对象表示，等等。因此，通过<code>ListBox.ItemContainerStyle</code>属性应用的样式都将用于设置每个<code>ListBoxItem</code>对象的属性。</p>
<blockquote>
<p>下面的示例，为每项应用蓝灰色背景。为了确保单个项和其他项能够相互区别，样式还添加了一些外边距空间：</p>
</blockquote>
<img src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/20240803165102.png"/>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ListBox</span> <span class="attr">Margin</span>=<span class="string">&quot;5&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ListBox.ItemContainerStyle</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Style</span> <span class="attr">TargetType</span>=<span class="string">&quot;&#123;x:Type ListBoxItem&#125;&quot;</span>&gt;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Setter</span> <span class="attr">Property</span>=<span class="string">&quot;Background&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;LightSteelBlue&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Setter</span> <span class="attr">Property</span>=<span class="string">&quot;Margin&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;5&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Setter</span> <span class="attr">Property</span>=<span class="string">&quot;Padding&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;5&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Style.Triggers</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Trigger</span> <span class="attr">Property</span>=<span class="string">&quot;IsSelected&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;True&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">Setter</span> <span class="attr">Property</span>=<span class="string">&quot;Background&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;DarkRed&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">Setter</span> <span class="attr">Property</span>=<span class="string">&quot;Foreground&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;White&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">Setter</span> <span class="attr">Property</span>=<span class="string">&quot;BorderBrush&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;Black&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">Setter</span> <span class="attr">Property</span>=<span class="string">&quot;BorderThickness&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;1&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">Trigger</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Style.Triggers</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        </span><span class="tag">&lt;/<span class="name">Style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ListBox.ItemContainerStyle</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sys:String</span>&gt;</span>🍎<span class="tag">&lt;/<span class="name">sys:String</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sys:String</span>&gt;</span>🍌<span class="tag">&lt;/<span class="name">sys:String</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sys:String</span>&gt;</span>🍐<span class="tag">&lt;/<span class="name">sys:String</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ListBox</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="包含子控件的ListBox控件"><a href="#包含子控件的ListBox控件" class="headerlink" title="包含子控件的ListBox控件"></a>包含子控件的ListBox控件</h3><p>&emsp;&emsp;如果希望深入到列表控件并修改项使用的控件模板,ItemContainerStyle属性同样十分重要例如，可使用这种技术，让每个 ListBoxItem 对象在项文本的旁边显示单选按钮或复选框。</p>
<img src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/20240803165435.png"/>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ListBox</span> <span class="attr">Margin</span>=<span class="string">&quot;5&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ListBox.ItemContainerStyle</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Style</span> <span class="attr">TargetType</span>=<span class="string">&quot;&#123;x:Type ListBoxItem&#125;&quot;</span>&gt;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Setter</span> <span class="attr">Property</span>=<span class="string">&quot;Background&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;LightSteelBlue&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Setter</span> <span class="attr">Property</span>=<span class="string">&quot;Margin&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;5&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Setter</span> <span class="attr">Property</span>=<span class="string">&quot;Padding&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;5&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Setter</span> <span class="attr">Property</span>=<span class="string">&quot;Template&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Setter.Value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">ControlTemplate</span> <span class="attr">TargetType</span>=<span class="string">&quot;&#123;x:Type ListBoxItem&#125;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">RadioButton</span> <span class="attr">Focusable</span>=<span class="string">&quot;False&quot;</span> <span class="attr">IsChecked</span>=<span class="string">&quot;&#123;Binding IsSelected, RelativeSource=&#123;RelativeSource TemplatedParent&#125;, Mode=TwoWay&#125;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                            <span class="tag">&lt;<span class="name">ContentPresenter</span> <span class="attr">VerticalAlignment</span>=<span class="string">&quot;Center&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;/<span class="name">RadioButton</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">ControlTemplate</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">Setter.Value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Setter</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Style.Triggers</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Trigger</span> <span class="attr">Property</span>=<span class="string">&quot;IsSelected&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;True&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">Setter</span> <span class="attr">Property</span>=<span class="string">&quot;Background&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;DarkRed&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">Setter</span> <span class="attr">Property</span>=<span class="string">&quot;Foreground&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;White&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">Setter</span> <span class="attr">Property</span>=<span class="string">&quot;BorderBrush&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;Black&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">Setter</span> <span class="attr">Property</span>=<span class="string">&quot;BorderThickness&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;1&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">Trigger</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Style.Triggers</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        </span><span class="tag">&lt;/<span class="name">Style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ListBox.ItemContainerStyle</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sys:String</span>&gt;</span>🍎<span class="tag">&lt;/<span class="name">sys:String</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sys:String</span>&gt;</span>🍌<span class="tag">&lt;/<span class="name">sys:String</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sys:String</span>&gt;</span>🍐<span class="tag">&lt;/<span class="name">sys:String</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ListBox</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>下面的样式规则将普通的ListBox转换成复选框列表</p>
</blockquote>
<img src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/20240803165639.png"/>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ListBox</span> <span class="attr">Margin</span>=<span class="string">&quot;5&quot;</span> <span class="attr">SelectionMode</span>=<span class="string">&quot;Multiple&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ListBox.ItemContainerStyle</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Style</span> <span class="attr">TargetType</span>=<span class="string">&quot;&#123;x:Type ListBoxItem&#125;&quot;</span>&gt;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Setter</span> <span class="attr">Property</span>=<span class="string">&quot;Background&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;LightSteelBlue&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Setter</span> <span class="attr">Property</span>=<span class="string">&quot;Margin&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;5&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Setter</span> <span class="attr">Property</span>=<span class="string">&quot;Padding&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;5&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Setter</span> <span class="attr">Property</span>=<span class="string">&quot;Template&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Setter.Value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">ControlTemplate</span> <span class="attr">TargetType</span>=<span class="string">&quot;&#123;x:Type ListBoxItem&#125;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">CheckBox</span> <span class="attr">Focusable</span>=<span class="string">&quot;False&quot;</span> <span class="attr">IsChecked</span>=<span class="string">&quot;&#123;Binding IsSelected, RelativeSource=&#123;RelativeSource TemplatedParent&#125;, Mode=TwoWay&#125;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                            <span class="tag">&lt;<span class="name">ContentPresenter</span> <span class="attr">VerticalAlignment</span>=<span class="string">&quot;Center&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;/<span class="name">CheckBox</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">ControlTemplate</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">Setter.Value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Setter</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Style.Triggers</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Trigger</span> <span class="attr">Property</span>=<span class="string">&quot;IsSelected&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;True&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">Setter</span> <span class="attr">Property</span>=<span class="string">&quot;Background&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;DarkRed&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">Setter</span> <span class="attr">Property</span>=<span class="string">&quot;Foreground&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;White&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">Setter</span> <span class="attr">Property</span>=<span class="string">&quot;BorderBrush&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;Black&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">Setter</span> <span class="attr">Property</span>=<span class="string">&quot;BorderThickness&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;1&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">Trigger</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Style.Triggers</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        </span><span class="tag">&lt;/<span class="name">Style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ListBox.ItemContainerStyle</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sys:String</span>&gt;</span>🍎<span class="tag">&lt;/<span class="name">sys:String</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sys:String</span>&gt;</span>🍌<span class="tag">&lt;/<span class="name">sys:String</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sys:String</span>&gt;</span>🍐<span class="tag">&lt;/<span class="name">sys:String</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ListBox</span>&gt;</span></span><br></pre></td></tr></table></figure>

<div class="note info flat"><p>可通过设置<code>ListBox.SelectionMode = Multiple</code>启用列表的多选</p>
</div>

<h3 id="交替条目样式"><a href="#交替条目样式" class="headerlink" title="交替条目样式"></a>交替条目样式</h3><p>&emsp;&emsp;格式化列表的一种常用方式是使用交替格式化——换句话说，用于区分列表中每两项的一套格式特征。交替行通常是通过稍微不同的背景色提供的，从而清晰地隔离行。</p>
<p>&emsp;&emsp;<strong>WPF通过两个属性为交替项提供了内置支持：<code>AlternationCount</code>和<code>AlternationIndex</code>。</strong> <em>AlternationCount</em>制定序列中项的数量，经过该数量的项之后交替样式。默认情况下，<em>AlternationCount</em>被设置为0，而且不使用交替格式。如果将<em>AlternationCount</em>设置为1，列表将在每项之后交替。</p>
<p>&emsp;&emsp;<strong>为每个ListBoxItem提供AlternationIndex属性，该属性用于确定在交替项序列中如何编号。假设将AlternationCount设置为2，第一个ListBoxItem将获得值为0的AlterationIndex，第二个将获得值为1的AlternationIndex，第3个将获得值为0的AlternationIndex，第4个将获得值为1的AlternationIndex等等</strong>。<code>技巧是使用触发器在ItemContainerStyle中检查AlternationIndex值并相应改变格式</code>。</p>
<blockquote>
<p>如下示例，在此显示的ListBox控件为交替项提供了稍微不同的背景颜色（除非已经选择了该项，否则这时针对ListBoxItem.IsSelected属性的具有更高优先级的触发器胜出）：</p>
</blockquote>
<img src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/20240803170829.png"/>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ListBox</span> <span class="attr">AlternationCount</span>=<span class="string">&quot;2&quot;</span> <span class="attr">Margin</span>=<span class="string">&quot;5&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ListBox.ItemContainerStyle</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Style</span> <span class="attr">TargetType</span>=<span class="string">&quot;&#123;x:Type ListBoxItem&#125;&quot;</span>&gt;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Setter</span> <span class="attr">Property</span>=<span class="string">&quot;Background&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;LightSteelBlue&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Setter</span> <span class="attr">Property</span>=<span class="string">&quot;Margin&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;5&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Setter</span> <span class="attr">Property</span>=<span class="string">&quot;Padding&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;5&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Style.Triggers</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Trigger</span> <span class="attr">Property</span>=<span class="string">&quot;ItemsControl.AlternationIndex&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">Setter</span> <span class="attr">Property</span>=<span class="string">&quot;Background&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;Orange&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">Trigger</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Trigger</span> <span class="attr">Property</span>=<span class="string">&quot;IsSelected&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;True&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">Setter</span> <span class="attr">Property</span>=<span class="string">&quot;Background&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;DarkRed&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">Setter</span> <span class="attr">Property</span>=<span class="string">&quot;Foreground&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;White&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">Setter</span> <span class="attr">Property</span>=<span class="string">&quot;BorderBrush&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;Black&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">Setter</span> <span class="attr">Property</span>=<span class="string">&quot;BorderThickness&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;1&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">Trigger</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Style.Triggers</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        </span><span class="tag">&lt;/<span class="name">Style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ListBox.ItemContainerStyle</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sys:String</span>&gt;</span>🍎<span class="tag">&lt;/<span class="name">sys:String</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sys:String</span>&gt;</span>🍌<span class="tag">&lt;/<span class="name">sys:String</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sys:String</span>&gt;</span>🍐<span class="tag">&lt;/<span class="name">sys:String</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sys:String</span>&gt;</span>🍉<span class="tag">&lt;/<span class="name">sys:String</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sys:String</span>&gt;</span>🍈<span class="tag">&lt;/<span class="name">sys:String</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sys:String</span>&gt;</span>🍍<span class="tag">&lt;/<span class="name">sys:String</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sys:String</span>&gt;</span>🍓<span class="tag">&lt;/<span class="name">sys:String</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sys:String</span>&gt;</span>🍇<span class="tag">&lt;/<span class="name">sys:String</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ListBox</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;您可能注意到了 AltermationIndex 是附加属性,该属性是由 ListBox类定义的(或者从技术上讲，是在其父类 ItemsControl 中定义的)。<strong>由于不是在 ListBoxltem 类中定义的，因此当在样式触发器中使用该属性时，需要指定类名。</strong></p>
<h3 id="样式选择器"><a href="#样式选择器" class="headerlink" title="样式选择器"></a>样式选择器</h3><p>&emsp;&emsp;现在您已看到了如何根据项的选择状态或在列表中的位置改变样式。然而，可能希望使用其他很多条件--依赖于您提供的数据而不是依赖于存储所提供数据的 ListBoxItem 容器的标准。</p>
<p>&emsp;&emsp;为处理这种情况，需要一种为不同的项提供完全不同样式的方法，当无法以声明的方式进行该工作。相反，需要构建专门的继承自<code>StyleSelector</code>的类。该类负责检查每个数据项并选择合适的样式。该工作是在<code>SelectStyle()</code>方法中执行的，必须重写该方法：</p>
<img src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/20240803172802.png"/>

<div class="tabs" id="styleselector"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="styleselector-1">RecommandFruitStyleSelector</button><button type="button" class="tab " data-href="styleselector-2">Xaml</button></ul><div class="tab-contents"><div class="tab-item-content active" id="styleselector-1"><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">RecommendFruitStyleSelector</span> : <span class="title">StyleSelector</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> Style HighlightStyle &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> Style DefaultStyle &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> HotFruits &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> Style <span class="title">SelectStyle</span>(<span class="params"><span class="built_in">object</span> item, DependencyObject container</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> fruits = HotFruits.Split(<span class="string">&#x27;,&#x27;</span>);</span><br><span class="line">        <span class="built_in">string</span> curent = (<span class="built_in">string</span>)item;</span><br><span class="line">        Window window = Application.Current.MainWindow;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (fruits.Contains(curent))</span><br><span class="line">            <span class="keyword">return</span> HighlightStyle;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> DefaultStyle;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="styleselector-2"><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;Window.Resources&gt;</span><br><span class="line">    &lt;Style TargetType=<span class="string">&quot;&#123;x:Type ListBoxItem&#125;&quot;</span> x:Key=<span class="string">&quot;DefaultFruitStyle&quot;</span>&gt;</span><br><span class="line">        &lt;Setter Property=<span class="string">&quot;Background&quot;</span> Value=<span class="string">&quot;Pink&quot;</span> /&gt;</span><br><span class="line">        &lt;Setter Property=<span class="string">&quot;Padding&quot;</span> Value=<span class="string">&quot;2&quot;</span> /&gt;</span><br><span class="line">    &lt;/Style&gt;</span><br><span class="line">    &lt;Style TargetType=<span class="string">&quot;&#123;x:Type ListBoxItem&#125;&quot;</span> x:Key=<span class="string">&quot;RecommandFruitStyle&quot;</span>&gt;</span><br><span class="line">        &lt;Setter Property=<span class="string">&quot;Background&quot;</span> Value=<span class="string">&quot;Red&quot;</span> /&gt;</span><br><span class="line">        &lt;Setter Property=<span class="string">&quot;Padding&quot;</span> Value=<span class="string">&quot;2&quot;</span> /&gt;</span><br><span class="line">        &lt;Setter Property=<span class="string">&quot;Foreground&quot;</span> Value=<span class="string">&quot;White&quot;</span> /&gt;</span><br><span class="line">    &lt;/Style&gt;</span><br><span class="line">&lt;/Window.Resources&gt;</span><br><span class="line">&lt;Grid&gt;</span><br><span class="line">    &lt;ListBox x:Name=<span class="string">&quot;lstFruits&quot;</span> AlternationCount=<span class="string">&quot;2&quot;</span> Margin=<span class="string">&quot;5&quot;</span>&gt;</span><br><span class="line">        &lt;ListBox.ItemContainerStyleSelector&gt;</span><br><span class="line">            &lt;selectors:RecommendFruitStyleSelector</span><br><span class="line">                DefaultStyle=<span class="string">&quot;&#123;StaticResource DefaultFruitStyle&#125;&quot;</span></span><br><span class="line">                HighlightStyle=<span class="string">&quot;&#123;StaticResource RecommandFruitStyle&#125;&quot;</span></span><br><span class="line">                HotFruits=<span class="string">&quot;🍉,🍌,🍓,🍇&quot;</span> /&gt;</span><br><span class="line">        &lt;/ListBox.ItemContainerStyleSelector&gt;</span><br><span class="line">        &lt;sys:String&gt;🍎&lt;/sys:String&gt;</span><br><span class="line">        &lt;sys:String&gt;🍌&lt;/sys:String&gt;</span><br><span class="line">        &lt;sys:String&gt;🍐&lt;/sys:String&gt;</span><br><span class="line">        &lt;sys:String&gt;🍉&lt;/sys:String&gt;</span><br><span class="line">        &lt;sys:String&gt;🍈&lt;/sys:String&gt;</span><br><span class="line">        &lt;sys:String&gt;🍍&lt;/sys:String&gt;</span><br><span class="line">        &lt;sys:String&gt;🍓&lt;/sys:String&gt;</span><br><span class="line">        &lt;sys:String&gt;🍇&lt;/sys:String&gt;</span><br><span class="line">    &lt;/ListBox&gt;</span><br><span class="line">&lt;/Grid&gt;</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div>

<div class="note warning flat"><p>创建使用一个或多个属性的样式选择器(Style)，可由使用者自行传入样式选择，个提高程序的通用性</p>
</div>

<p>&emsp;&emsp;<strong>样式选择过程只执行一次，当第一次绑定列表时执行。如果正在显示可编辑的数据，并且当进行编辑时可能将数据项从一个样式类别移到另一个样式类别中，这就会成为问题。在这种情况下，需要强制 WPF 重新应用样式，并且没有优雅的方式完成该任务。粗鲁的方法是通过将ItemComtainerStyleSelector 属性设置为 nul 来移除样式选择器，然后再次指定样式选择器:</strong></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">StyleSelector selector = lstFruits.ItemContainerStyleSelector;</span><br><span class="line">lstFruits.ItemContainerStyleSelector = <span class="literal">null</span>;</span><br><span class="line">lstFruits.ItemContainerStyleSelector = selector; <span class="comment">// 重新赋值</span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;<em>可通过处理事件来响应特定修改，从而选择自动运行上面的代码，例如ProperyChanged 事件(所有实现了 INotifyPropertyChanged接口的类都会引发该事件，包括Product类)DataTable.RowChanged 事件(如果使用 ADO.NET 数据对象，可以处理该事件)以及更常用的Binding.SourceUpdated事件(只有当 Binding.NotifyOnSourceUpdated为tmue时,才会引发该事件)。当重新指定样式选择器时，WPF 检查并更新列表中的每个项--对于较小或中等规模的列表而言，该过程是较快的。</em></p>
<h2 id="数据模板"><a href="#数据模板" class="headerlink" title="数据模板"></a>数据模板</h2><p>&emsp;&emsp;样式提供了基本的格式化能力，但它们不能消除到目前为止看到的列表的最重要局限性:不管如何修改 ListBoxItem，它都只是 ListBoxItem，而不是功能更强大的元素组合。并且因为每个 ListBoxItem 只支持单个绑定字段(因为是通过 DisplayMemberPath 属性进行设置)，所以不可能实现包含多个字段或图像的富列表。</p>
<p>&emsp;&emsp;然而，WPF 另有一个工具可突破这个相当大的限制，允许组合使用来自绑定对象的多个属性，并以特定的方式排列它们或显示比简单字符串更高级的可视化表示。这个工具就是数据模板。</p>
<p>&emsp;&emsp;<strong>数据模板是一块定义如何显示绑定的数据对象的XAML标记。有两种类型的控件支持数据模板：</strong></p>
<ul>
<li>内容控件通过<code>ContentTemplate</code>属性支持数据模板。内容模板用于显示任何放置在<code>Content</code>属性中的内容</li>
<li>列表控件（继承自<em>ItemsControl</em>类的控件）通过<code>ItemTemplate</code>属性支持数据模板。这个模板用于显示作为<code>ItemsSource</code>提供的集合中的每个项（或来自DataTable的每一行）</li>
</ul>
<p>&emsp;&emsp;<strong>基于列表的模板特性实际上以内容控件模板为基础。这是因为列表中的每个项均由内容控件封装</strong>，例如用于 ListBox 控件的 ListBoxItem 元素、用于 ComboBox 控件的 ComboBoxItem 元素，等等。不管为列表的ItemTemplate 属性指定什么样的模板，模板都被用作列表中每项的ContentTemplate 模板。</p>
<img src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/20240803182109.png" width="50%"/>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ListBox</span> <span class="attr">HorizontalAlignment</span>=<span class="string">&quot;Stretch&quot;</span> <span class="attr">ItemsSource</span>=<span class="string">&quot;&#123;Binding Products&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ListBox.ItemTemplate</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">DataTemplate</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Border</span></span></span><br><span class="line"><span class="tag">                <span class="attr">BorderBrush</span>=<span class="string">&quot;SteelBlue&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">BorderThickness</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">CornerRadius</span>=<span class="string">&quot;4&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">Margin</span>=<span class="string">&quot;5&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">Grid</span> <span class="attr">Margin</span>=<span class="string">&quot;3&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">Grid.RowDefinitions</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">RowDefinition</span> /&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">RowDefinition</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">Grid.RowDefinitions</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">TextBlock</span> <span class="attr">FontWeight</span>=<span class="string">&quot;Bold&quot;</span> <span class="attr">Text</span>=<span class="string">&quot;&#123;Binding ModelNumber&#125;&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">TextBlock</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">FontWeight</span>=<span class="string">&quot;Bold&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">Grid.Row</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">Text</span>=<span class="string">&quot;&#123;Binding ModelName&#125;&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">Grid</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Border</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">DataTemplate</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ListBox.ItemTemplate</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ListBox</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="分离和重用模板"><a href="#分离和重用模板" class="headerlink" title="分离和重用模板"></a>分离和重用模板</h3><p>&emsp;&emsp;与样式类似，通常也将模板声明为窗口或应用程序的资源，而不是在使用它们的列表中进行定义。这种隔离通常更加清晰，当在同一个控件中使用很长的、复杂的一个或多个模板时尤其如此。当希望在用户界面的不同地方以相同的方式呈现数据时，这样还允许在多个列表或内容控件中重用模板。</p>
<blockquote>
<p>为使该方法奏效，只需要在资源集合中定义数据模板并赋予键名。下面的示例提取上面示例中显示的模板</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Window.Resources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">DataTemplate</span> <span class="attr">x:Key</span>=<span class="string">&quot;ProductDataTemplate&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Border</span></span></span><br><span class="line"><span class="tag">            <span class="attr">BorderBrush</span>=<span class="string">&quot;SteelBlue&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">BorderThickness</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">CornerRadius</span>=<span class="string">&quot;4&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Grid</span> <span class="attr">Margin</span>=<span class="string">&quot;3&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">Grid.RowDefinitions</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">RowDefinition</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">RowDefinition</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">Grid.RowDefinitions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TextBlock</span> <span class="attr">FontWeight</span>=<span class="string">&quot;Bold&quot;</span> <span class="attr">Text</span>=<span class="string">&quot;&#123;Binding ModelNumber&#125;&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TextBlock</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">FontWeight</span>=<span class="string">&quot;Bold&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">Grid.Row</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">Text</span>=<span class="string">&quot;&#123;Binding ModelName&#125;&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Grid</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Border</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">DataTemplate</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Window.Resources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Grid</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ListBox</span></span></span><br><span class="line"><span class="tag">        <span class="attr">HorizontalContentAlignment</span>=<span class="string">&quot;Stretch&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">ItemTemplate</span>=<span class="string">&quot;&#123;StaticResource ProductDataTemplate&#125;&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">ItemsSource</span>=<span class="string">&quot;&#123;Binding Products&#125;&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Grid</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="使用更高级的模板"><a href="#使用更高级的模板" class="headerlink" title="使用更高级的模板"></a>使用更高级的模板</h3><p>&emsp;&emsp;数据模板可包含非常丰富的内容。除基本元素外，如 TextBlock 控件和数据绑定表达式，们还能使用更复杂的控件、关联事件处理程序、将数据转换为不同的表达形式以及使用动画等。</p>
<img src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/WpfApp_vviMZ9BVfC.gif">

<div class="tabs" id="superdatatemplate"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="superdatatemplate-1">XML</button><button type="button" class="tab " data-href="superdatatemplate-2">CodeBind</button></ul><div class="tab-contents"><div class="tab-item-content active" id="superdatatemplate-1"><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Window.Resources</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">DataTemplate</span> <span class="attr">x:Key</span>=<span class="string">&quot;ListBoxItemDataTemplate&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Border</span></span></span><br><span class="line"><span class="tag">                <span class="attr">BorderBrush</span>=<span class="string">&quot;SteelBlue&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">BorderThickness</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">CornerRadius</span>=<span class="string">&quot;4&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">Padding</span>=<span class="string">&quot;5&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">Grid</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">TextBlock</span> <span class="attr">Text</span>=<span class="string">&quot;&#123;TemplateBinding Content&#125;&quot;</span> <span class="attr">VerticalAlignment</span>=<span class="string">&quot;Center&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">Click</span>=<span class="string">&quot;cmdView_Clicked&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">Content</span>=<span class="string">&quot;View&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">HorizontalAlignment</span>=<span class="string">&quot;Right&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">Tag</span>=<span class="string">&quot;&#123;TemplateBinding Content&#125;&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">Grid</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Border</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">DataTemplate</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Window.Resources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Grid</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Grid.ColumnDefinitions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ColumnDefinition</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ColumnDefinition</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Grid.ColumnDefinitions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ListBox</span></span></span><br><span class="line"><span class="tag">            <span class="attr">Grid.Column</span>=<span class="string">&quot;0&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">HorizontalContentAlignment</span>=<span class="string">&quot;Stretch&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">ItemTemplate</span>=<span class="string">&quot;&#123;StaticResource ListBoxItemDataTemplate&#125;&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">x:Name</span>=<span class="string">&quot;LstThemes&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">sys:String</span>&gt;</span>Dark<span class="tag">&lt;/<span class="name">sys:String</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">sys:String</span>&gt;</span>Light<span class="tag">&lt;/<span class="name">sys:String</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ListBox</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Image</span> <span class="attr">Grid.Column</span>=<span class="string">&quot;1&quot;</span> <span class="attr">Source</span>=<span class="string">&quot;&#123;Binding ImagePath, Converter=&#123;cvt:ImagePathConverter&#125;&#125;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Grid</span>&gt;</span></span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="superdatatemplate-2"><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">cmdView_Clicked</span>(<span class="params"><span class="built_in">object</span> sender, RoutedEventArgs e</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    Button cmd = (Button)sender;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> vm = (<span class="keyword">this</span>.DataContext <span class="keyword">as</span> MainWindowViewModel);</span><br><span class="line">    vm.ImagePath = <span class="string">$&quot;<span class="subst">&#123;cmd.Tag&#125;</span>.png&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div>


<p>&emsp;&emsp;在这个示例中的技巧是对按钮单击的处理。显然，所有按钮都被连接到同一个事件处理程序。这个事件处理程序在模板中定义，因此可以在Button的Tag属性中存储一些额外的标识信息。</p>
<h3 id="改变模板"><a href="#改变模板" class="headerlink" title="改变模板"></a>改变模板</h3><p>&emsp;&emsp;使用到目前为止介绍的数据模板的一个限制是，只能为整个列表使用一个模板。当在许多情况下，希望采用不同方式灵活地表示不同的数据。可使用多种方式实现这一目标，下面是一些常用技术：</p>
<ul>
<li><strong>使用数据触发器</strong>。可根据绑定的数据对象中的属性值使用触发器修改模板中的属性。除了不需要依赖项属性外，数据触发器与样式的属性触发器的工作方式类似</li>
<li><strong>使用值转换器</strong>。实现了<em>IValueConverter</em>接口的类，能够将值成绑定的对象转换为可用于设置模板中与格式化相关的属性的值</li>
<li><strong>使用模板选择器</strong>。模板选择器插件绑定的数据对象，并在几个不同模板之间进行选择</li>
</ul>
<blockquote>
<p>数据触发器提供了最简单的方法。基本技术是根据数据项中的某个属性，设置模板中某个元素的某个属性:<em>（例如，如果是Tools类型的商品者显示为红色）</em></p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">DataTemplate</span> <span class="attr">x:Key</span>=<span class="string">&quot;DefaultTemplate&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">DataTemplate.Trigger</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">DataTrigger</span> <span class="attr">Biding</span>=<span class="string">&quot;&#123;Binding CategoryName&#125;&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;Tools&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Setter</span> <span class="attr">Property</span>=<span class="string">&quot;ListBoxItem.Foreground&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;Red&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">DataTrigger</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">DataTemplate.Trigger</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Border</span> <span class="attr">Margin</span>=<span class="string">&quot;5&quot;</span> <span class="attr">BorderThickness</span>=<span class="string">&quot;1&quot;</span> <span class="attr">BorderBrush</span>=<span class="string">&quot;SteelBlue&quot;</span>&gt;</span></span><br><span class="line">        ....</span><br><span class="line">    <span class="tag">&lt;/<span class="name">Border</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">DataTemplate</span>&gt;</span></span><br></pre></td></tr></table></figure>

<div class="note info flat"><p>数据触发器和值转换器只是在修改模板中的某个属性，如果需要完全采用不同的模板，请使用模板选择器</p>
</div>

<h3 id="模板选择器"><a href="#模板选择器" class="headerlink" title="模板选择器"></a>模板选择器</h3><p>&emsp;&emsp;另一中更强大的选择是，为项赋于完全不同的模板。为此，需要创建继承自<code>DataTemplateSelector</code>的类。模板选择器的工作方式和在前面分析的样式选择器的工作方式相同——它们检查绑定对象并使用您提供的逻辑选择合适的模板。</p>
<blockquote>
<p>下面的例子根据ListItemType选择不同的模板</p>
</blockquote>
<div class="tabs" id="datatemplateselector"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="datatemplateselector-1">ListBoxItemTypeTemplateSelector</button><button type="button" class="tab " data-href="datatemplateselector-2">Xaml</button></ul><div class="tab-contents"><div class="tab-item-content active" id="datatemplateselector-1"><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="built_in">enum</span> ListItemType</span><br><span class="line">&#123;</span><br><span class="line">    RadioButton,</span><br><span class="line">    CheckBox</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ListBoxItemTypeTemplateSelector</span> : <span class="title">DataTemplateSelector</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> DataTemplate RadioTemplate &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> DataTemplate CheckBoxTemplate &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ListItemType ItemType &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> DataTemplate <span class="title">SelectTemplate</span>(<span class="params"><span class="built_in">object</span> item, DependencyObject container</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// item 是ListBox每一项数据，这里没有根据数据选择模板</span></span><br><span class="line">        <span class="keyword">if</span> (ItemType == ListItemType.CheckBox)</span><br><span class="line">            <span class="keyword">return</span> CheckBoxTemplate;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> RadioTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="datatemplateselector-2"><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Window.Resources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">DataTemplate</span> <span class="attr">x:Key</span>=<span class="string">&quot;RadioDataTemplate&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Border</span></span></span><br><span class="line"><span class="tag">            <span class="attr">BorderBrush</span>=<span class="string">&quot;SteelBlue&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">BorderThickness</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">CornerRadius</span>=<span class="string">&quot;4&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">Padding</span>=<span class="string">&quot;5&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">RadioButton</span></span></span><br><span class="line"><span class="tag">                <span class="attr">Content</span>=<span class="string">&quot;&#123;TemplateBinding Content&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">Focusable</span>=<span class="string">&quot;False&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">IsChecked</span>=<span class="string">&quot;&#123;Binding IsSelected, RelativeSource=&#123;RelativeSource FindAncestor, AncestorType=&#123;x:Type ListBoxItem&#125;&#125;, Mode=TwoWay&#125;&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Border</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">DataTemplate</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">DataTemplate</span> <span class="attr">x:Key</span>=<span class="string">&quot;CheckBoxDataTemplate&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Border</span></span></span><br><span class="line"><span class="tag">            <span class="attr">BorderBrush</span>=<span class="string">&quot;SteelBlue&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">BorderThickness</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">CornerRadius</span>=<span class="string">&quot;4&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">Padding</span>=<span class="string">&quot;5&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">CheckBox</span></span></span><br><span class="line"><span class="tag">                <span class="attr">Content</span>=<span class="string">&quot;&#123;TemplateBinding Content&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">Focusable</span>=<span class="string">&quot;False&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">IsChecked</span>=<span class="string">&quot;&#123;Binding IsSelected, RelativeSource=&#123;RelativeSource FindAncestor, AncestorType=&#123;x:Type ListBoxItem&#125;&#125;, Mode=TwoWay&#125;&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Border</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">DataTemplate</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Window.Resources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Grid</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ListBox</span> <span class="attr">HorizontalContentAlignment</span>=<span class="string">&quot;Stretch&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ListBox.ItemTemplateSelector</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">selectors:ListBoxItemTypeTemplateSelector</span></span></span><br><span class="line"><span class="tag">                <span class="attr">CheckBoxTemplate</span>=<span class="string">&quot;&#123;StaticResource CheckBoxDataTemplate&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">ItemType</span>=<span class="string">&quot;RadioButton&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">RadioTemplate</span>=<span class="string">&quot;&#123;StaticResource RadioDataTemplate&#125;&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ListBox.ItemTemplateSelector</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sys:String</span>&gt;</span>男<span class="tag">&lt;/<span class="name">sys:String</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sys:String</span>&gt;</span>女<span class="tag">&lt;/<span class="name">sys:String</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ListBox</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">Grid</span>&gt;</span></span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div>

<p>&emsp;&emsp;这种方法的一个缺点是，可能必须创建多个类似的模板。如果模板比较复杂，这种方法会造成大量的重复。为尽量提高可维护性，不应为单个列表创建过多模板--而应当使用触发器和样式为模板应用不同的格式。</p>
<div class="note warning flat"><p>TemplateBinding 通常用于 ControlTemplate，而 Binding 更常用于 DataTemplate。TemplateBinding 是一种特殊的绑定形式，用于绑定到模板所属控件的属性。而在 DataTemplate 中，通常是绑定到数据对象的属性。</p>
</div>

<div class="note warning flat"><p><strong>在DataTemplate中也不能直接使用<code>ContentPresenter</code></strong></p>
</div>


<h3 id="模板与选择"><a href="#模板与选择" class="headerlink" title="模板与选择"></a>模板与选择</h3><p>&emsp;&emsp;如果在列表中选择了一项，WPF 会自动设置项容器(在此是 ListBoxltem 对象)的 Foreground 和Background 属性。前景色是白色，背景色是蓝色。Foreground 属性使用属性继承，所以添加到模板中的任何元素都自动获得新的白色，除非明确指定新的颜色。<strong>Background 属性不使用属性继承，但默认的 Background 值是 Transparent</strong>。例如，如果边框也是透明的，就会穿透显示新的蓝色背景。否则仍然应用在模板中设置的颜色。</p>
<blockquote>
<p>例如下面的示例，直接通过触发器设置项选中后的背景色是不生效的：</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ListBox</span> <span class="attr">HorizontalContentAlignment</span>=<span class="string">&quot;Stretch&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ListBox.ItemContainerStyle</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Style</span> <span class="attr">TargetType</span>=<span class="string">&quot;&#123;x:Type ListBoxItem&#125;&quot;</span>&gt;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Setter</span> <span class="attr">Property</span>=<span class="string">&quot;Padding&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;0&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Style.Triggers</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Trigger</span> <span class="attr">Property</span>=<span class="string">&quot;IsSelected&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;True&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">Setter</span> <span class="attr">Property</span>=<span class="string">&quot;Background&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;DarkRed&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">Trigger</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Style.Triggers</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        </span><span class="tag">&lt;/<span class="name">Style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ListBox.ItemContainerStyle</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sys:String</span>&gt;</span>🍉<span class="tag">&lt;/<span class="name">sys:String</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sys:String</span>&gt;</span>🍓<span class="tag">&lt;/<span class="name">sys:String</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sys:String</span>&gt;</span>🍇<span class="tag">&lt;/<span class="name">sys:String</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sys:String</span>&gt;</span>🍈<span class="tag">&lt;/<span class="name">sys:String</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sys:String</span>&gt;</span>🍍<span class="tag">&lt;/<span class="name">sys:String</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ListBox</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;触发器为选择的项应用深红色背景，但上面的代码不能为使用模板的列表提供所期望的效果。这是因为这些模板包含了使用不同背景颜色的元素，这些元素在深红色背景上显示。除非所有内容都是透明的(从而使红色背景能够透过整个模板)，否则只会在模板的外边距区域看到一条很细的红色边线。</p>
<p>&emsp;&emsp;<strong>解决方法是将模板中部分元素的背景显式绑定到ListBoxItem.Background 属性的值。这是合理的--毕竟，现在能够选择正确的背景颜色来突出显示选择的项。只需要确保它在正确的位置显示。</strong></p>
<div class="tabs" id="bindingrelativesource"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="bindingrelativesource-1">DataTemplate方式</button><button type="button" class="tab " data-href="bindingrelativesource-2">ControlTemplate</button></ul><div class="tab-contents"><div class="tab-item-content active" id="bindingrelativesource-1"><p>&emsp;&emsp;在直接使用触发器修改背景色的基础上，重写数据模板通过<code>Binding RelativeSource</code>让数据模块的外观背景色与<code>ListBoxItem</code>的背景色进行绑定</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ListBox</span> <span class="attr">HorizontalContentAlignment</span>=<span class="string">&quot;Stretch&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ListBox.ItemContainerStyle</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Style</span> <span class="attr">TargetType</span>=<span class="string">&quot;&#123;x:Type ListBoxItem&#125;&quot;</span>&gt;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Setter</span> <span class="attr">Property</span>=<span class="string">&quot;Padding&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;0&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Style.Triggers</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Trigger</span> <span class="attr">Property</span>=<span class="string">&quot;IsSelected&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;True&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">Setter</span> <span class="attr">Property</span>=<span class="string">&quot;Background&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;DarkRed&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">Trigger</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Style.Triggers</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        </span><span class="tag">&lt;/<span class="name">Style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ListBox.ItemContainerStyle</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ListBox.ItemTemplate</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">DataTemplate</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Border</span> <span class="attr">Background</span>=<span class="string">&quot;&#123;Binding Background, RelativeSource=&#123;RelativeSource FindAncestor, AncestorType=&#123;x:Type ListBoxItem&#125;&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TextBlock</span> <span class="attr">Text</span>=<span class="string">&quot;&#123;Binding Content, RelativeSource=&#123;RelativeSource FindAncestor, AncestorType=&#123;x:Type ListBoxItem&#125;&#125;&#125;&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Border</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">DataTemplate</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ListBox.ItemTemplate</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sys:String</span>&gt;</span>🍉<span class="tag">&lt;/<span class="name">sys:String</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sys:String</span>&gt;</span>🍓<span class="tag">&lt;/<span class="name">sys:String</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sys:String</span>&gt;</span>🍇<span class="tag">&lt;/<span class="name">sys:String</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sys:String</span>&gt;</span>🍈<span class="tag">&lt;/<span class="name">sys:String</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sys:String</span>&gt;</span>🍍<span class="tag">&lt;/<span class="name">sys:String</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ListBox</span>&gt;</span></span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="bindingrelativesource-2"><p>&emsp;&emsp;通过重写<code>ListBoxItem</code>的控件模板，在控件模板的外观中进行背景色的绑定，并在控件模板内使用触发器修改背景色</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ListBox</span> <span class="attr">HorizontalContentAlignment</span>=<span class="string">&quot;Stretch&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ListBox.ItemContainerStyle</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Style</span> <span class="attr">TargetType</span>=<span class="string">&quot;&#123;x:Type ListBoxItem&#125;&quot;</span>&gt;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Setter</span> <span class="attr">Property</span>=<span class="string">&quot;Padding&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;0&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Setter</span> <span class="attr">Property</span>=<span class="string">&quot;Template&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Setter.Value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">ControlTemplate</span> <span class="attr">TargetType</span>=<span class="string">&quot;&#123;x:Type ListBoxItem&#125;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">Border</span> <span class="attr">Background</span>=<span class="string">&quot;&#123;TemplateBinding Background&#125;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                            <span class="tag">&lt;<span class="name">ContentPresenter</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;/<span class="name">Border</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">ControlTemplate.Triggers</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                            <span class="tag">&lt;<span class="name">Trigger</span> <span class="attr">Property</span>=<span class="string">&quot;IsSelected&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;True&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                                <span class="tag">&lt;<span class="name">Setter</span> <span class="attr">Property</span>=<span class="string">&quot;Background&quot;</span> <span class="attr">Value</span>=<span class="string">&quot;DarkRed&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                            <span class="tag">&lt;/<span class="name">Trigger</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;/<span class="name">ControlTemplate.Triggers</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">ControlTemplate</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">Setter.Value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Setter</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        </span><span class="tag">&lt;/<span class="name">Style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ListBox.ItemContainerStyle</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sys:String</span>&gt;</span>🍉<span class="tag">&lt;/<span class="name">sys:String</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sys:String</span>&gt;</span>🍓<span class="tag">&lt;/<span class="name">sys:String</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sys:String</span>&gt;</span>🍇<span class="tag">&lt;/<span class="name">sys:String</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sys:String</span>&gt;</span>🍈<span class="tag">&lt;/<span class="name">sys:String</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sys:String</span>&gt;</span>🍍<span class="tag">&lt;/<span class="name">sys:String</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ListBox</span>&gt;</span></span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div>

<h3 id="改变项的布局"><a href="#改变项的布局" class="headerlink" title="改变项的布局"></a>改变项的布局</h3><p>&emsp;&emsp;使用数据模板可非常灵活地控制项显示的各个方面，但它们不允许根据项之间的关系更改项的组织方式。不管使用什么样的模板和样式,ListBox控件总是在独立的水平行中放置每个项并堆叠每行从而创建列表。</p>
<p>&emsp;&emsp;可通过替换列表用于布局其子元素的容器来改变这种布局。为此，需要使用一块XAML标记(定义希望使用的面板)来设置ItemsPanelTemplate 属性。这个面板可以是继承自 <code>System.Windows.Controls.Panel</code> 的任意类。</p>
<blockquote>
<p>下面的示例使用WrapPanel面板男封装项，这些项跨域ListBox控件的可用宽度</p>
</blockquote>
<img src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/20240803220157.png"/>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ListBox</span> <span class="attr">HorizontalContentAlignment</span>=<span class="string">&quot;Stretch&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ListBox.ItemsPanel</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ItemsPanelTemplate</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">WrapPanel</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ItemsPanelTemplate</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ListBox.ItemsPanel</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sys:String</span>&gt;</span>🍉<span class="tag">&lt;/<span class="name">sys:String</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sys:String</span>&gt;</span>🍓<span class="tag">&lt;/<span class="name">sys:String</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sys:String</span>&gt;</span>🍇<span class="tag">&lt;/<span class="name">sys:String</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sys:String</span>&gt;</span>🍈<span class="tag">&lt;/<span class="name">sys:String</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sys:String</span>&gt;</span>🍍<span class="tag">&lt;/<span class="name">sys:String</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ListBox</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;<strong>这种方法有一个陷阱。通常，大多数列表控件使用 VirtualizingStackPanel 面板而不是使用标准的 StackPane! 面板。</strong>如第19章所述，VirtualizingStackPanel 面板确保能够高效地处理大量的绑定数据。当使用 VirtualizingStackPanel 面板时，只创建显示当前可见项所需的元素。当使用StackPanel面板时，为整个列表创建所需的元素。如果数据源包含数千项(或更多)，VirtualizingStackPanel 面板使用的内存要少得多。当填充列表并且当用户在列表中滚动时，使用VirtualizingStackPanel 面板可以执行得更好，因为 WPF 布局系统需要完成的工作要少得多。</p>
<p>&emsp;&emsp;<strong>因此，不应设置新的 ItemsPanelTemplate，除非使用列表显示数量适中的数据。</strong>如果处于模糊地带——例如，正在显示的数据列表只有200个项并且有一个极其复杂的模板---可以针对这两种方法进行性能分析，查看性能和内存使用的变化情况，从而选择最佳策略</p>
<h2 id="ComboxBox控件"><a href="#ComboxBox控件" class="headerlink" title="ComboxBox控件"></a>ComboxBox控件</h2><p>&emsp;&emsp;与 ListBox 类一样,ComboBox 类是 Selector类的派生类。与ListBox 类不同的是,ComboBox类增加了另外两个部分:显示当前选择项的选择框和用于选择项的下拉列表。当单击组合框边缘上的下拉箭头时会显示下拉列表。或者，如果组合框处于只读模式(默认设置)，可通过单击选择框的任意位置展开下拉列表。最后，可通过代码设置IsDropDownOpen属性来打开或关闭下拉列表。</p>
<p>&emsp;&emsp;通常，ComboBox 控件显示一个只读组合框，这意味着可使用它选择一个项，但不能随意输入自己的内容。然而，可通过将IsReadOnly属性设置为 false 并将 IsEditable 属性设置 true 来改变这种行为。现在选择框变成了文本框，并且可在其中输入希望的任何文本。</p>
<p>&emsp;&emsp;<em>ComboBox 控件提供了基本的自动完成功能，当输入内容时会自动完成输入(不要与IE这类程序中花哨的自动完成功能相混淆，此处的自动完成功能会在当前文本框的下面显示所有可能项的列表)。下面是它的工作原理--当在 ComboBox 控件中键入内容时，WPF 使用第一个四配自动完成建议的项填充选择框中的剩余内容。例如,如果输入Gr 并且列表中包含字符串 Green,组合框就会填充字母een。由于自动完成文本是可选的，因此当继续键入内容时会自动覆盖原来的文本。</em></p>
<p>&emsp;&emsp;<strong>如果不希望使用自动完成行为,只需要将 ComboBox.IsTextSearchEnabled 属性设置为 false。这个属性继承自 ItemsContol基类，并被应用到许多其他列表控件。例如，如果在 ListBox 控件中将 IsTextSearchEnabled 属性设置为 tue,就可输入一个项的第一层次内容以跳到该项的位置。</strong></p>
<div class="note info flat"><p>WPF 没有为使用系统跟踪的自动完成列表提供任何功能，例如最近使用的URI 以及文件列表，也不支持自动完成下拉列表。</p>
</div>

<p>&emsp;&emsp;<em>如果 IsEditable 属性为 true，ComboBox 控件的行为会发生变化。不是显示选择项的副本，而是显示选择项的文本形式表示。为创建这种文本表示形式，WPF简单地为每个项调用ToString()方法。下图在这个示例中，显示的文本“DataBinding.Product”只是当前选择的 Product对象的完全限定类名，这是 ToSting()方法的默认实现，除非在自定义的数据类中重写该方法。</em></p>
<img src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/20240803221046.png" width="50%"/>

<p>&emsp;&emsp;解决这个问题最容易的方法是设置 TextSearch.TextPath 附加属性，指示应当被用于选择框内容的属性。下面是一个示例:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ComboBox</span> <span class="attr">IsEditable</span>=<span class="string">&quot;True&quot;</span> <span class="attr">IsReadOnly</span>=<span class="string">&quot;True&quot;</span> <span class="attr">TextSearch.TextPath</span>=<span class="string">&quot;ModelName&quot;</span> <span class="attr">...</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;尽管 IsEditable 属性必须为 true，但由您决定 IsReadOnly 属性的设置是 false(表示允许编辑该属性)还是 true(表示阻止用户随意输入内容)。</p>
<p>&emsp;&emsp;<em>如果希望显示更丰富的内容，而不只是显示一块简单文本，但又希望选择框中的内容与下拉列表中的内容不同，那么应如何实现这种效果呢?CoboBox控件提供了SelectionBoxItemTemplate 属性，该属性定义了为选择框使用的模板。遗憾的是，SelectionBoxltemTemplate 属性是只读的。它自动设置为与当前项相匹配，并且不能提供不同的模板。但可创建全新的根本不使用 SelectionBoxltemTemplate 属性的 ComboBox 控件模板，这个控件模板可硬编码选择框模板或从窗口的资源集合中检索选择框模板。</em></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://bootree.cn">大白</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://bootree.cn/2024/08/03/WPF%E7%BC%96%E7%A8%8B%E5%AE%9D%E5%85%B8/20%E6%A0%BC%E5%BC%8F%E5%8C%96%E7%BB%91%E5%AE%9A%E7%9A%84%E6%95%B0%E6%8D%AE/">http://bootree.cn/2024/08/03/WPF%E7%BC%96%E7%A8%8B%E5%AE%9D%E5%85%B8/20%E6%A0%BC%E5%BC%8F%E5%8C%96%E7%BB%91%E5%AE%9A%E7%9A%84%E6%95%B0%E6%8D%AE/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://bootree.cn" target="_blank">生活中的tree</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/WPF%E7%BC%96%E7%A8%8B%E5%AE%9D%E5%85%B8/">WPF编程宝典</a></div><div class="post_share"><div class="social-share" data-image="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/wpf.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://jsd.012700.xyz/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://jsd.012700.xyz/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src= "/img/loading.gif" data-lazy-src="/img/wechat.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src= "/img/loading.gif" data-lazy-src="/img/alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/08/04/WPF%E7%BC%96%E7%A8%8B%E5%AE%9D%E5%85%B8/21%E6%95%B0%E6%8D%AE%E8%A7%86%E5%9B%BE/" title="WPF编程宝典 - 21数据视图"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/wpf.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">WPF编程宝典 - 21数据视图</div></div></a></div><div class="next-post pull-right"><a href="/2024/07/31/WPF%E7%BC%96%E7%A8%8B%E5%AE%9D%E5%85%B8/19%E6%95%B0%E6%8D%AE%E7%BB%91%E5%AE%9A/" title="WPF编程宝典 - 19数据绑定"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/wpf.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">WPF编程宝典 - 19数据绑定</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2024/05/24/WPF%E7%BC%96%E7%A8%8B%E5%AE%9D%E5%85%B8/03%E5%B8%83%E5%B1%80/" title="WPF编程宝典 - 03布局"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/20240527195817.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-24</div><div class="title">WPF编程宝典 - 03布局</div></div></a></div><div><a href="/2024/05/22/WPF%E7%BC%96%E7%A8%8B%E5%AE%9D%E5%85%B8/01%E6%A6%82%E8%BF%B0/" title="WPF编程宝典 - 01概述"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/wpf.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-22</div><div class="title">WPF编程宝典 - 01概述</div></div></a></div><div><a href="/2024/05/28/WPF%E7%BC%96%E7%A8%8B%E5%AE%9D%E5%85%B8/05%E8%B7%AF%E7%94%B1%E4%BA%8B%E4%BB%B6/" title="WPF编程宝典 - 05路由事件"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/wpf.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-28</div><div class="title">WPF编程宝典 - 05路由事件</div></div></a></div><div><a href="/2024/05/25/WPF%E7%BC%96%E7%A8%8B%E5%AE%9D%E5%85%B8/04%E4%BE%9D%E8%B5%96%E5%B1%9E%E6%80%A7/" title="WPF编程宝典 - 04依赖属性"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/wpf.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-25</div><div class="title">WPF编程宝典 - 04依赖属性</div></div></a></div><div><a href="/2024/05/23/WPF%E7%BC%96%E7%A8%8B%E5%AE%9D%E5%85%B8/02XAML/" title="WPF编程宝典 - 02XAML"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/20240527195528.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-23</div><div class="title">WPF编程宝典 - 02XAML</div></div></a></div><div><a href="/2024/05/29/WPF%E7%BC%96%E7%A8%8B%E5%AE%9D%E5%85%B8/06%E6%8E%A7%E4%BB%B6/" title="WPF编程宝典 - 06控件"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/wpf.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-29</div><div class="title">WPF编程宝典 - 06控件</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "/img/loading.gif" data-lazy-src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">大白</div><div class="author-info__description">人不可能同时拥有青春和对青春的感受</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">67</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">17</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">20</div></a></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/cnlicm"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/cnlicm" rel="external nofollow noreferrer" target="_blank" title="Github"><i class="fab fa-github" style="color: #hdhfbb;"></i></a><a class="social-icon" href="mailto:codenobugs@foxmail.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #000000;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">A lazy guy. My dream is that generate electricity with love.</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E8%BD%AC%E6%8D%A2"><span class="toc-number">1.</span> <span class="toc-text">数据转换</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8StringFormat%E5%B1%9E%E6%80%A7"><span class="toc-number">1.1.</span> <span class="toc-text">使用StringFormat属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%80%BC%E8%BD%AC%E6%8D%A2%E5%99%A8"><span class="toc-number">1.2.</span> <span class="toc-text">值转换器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%80%BC%E8%BD%AC%E6%8D%A2%E5%99%A8%E8%AE%BE%E7%BD%AE%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E6%A0%BC%E5%BC%8F"><span class="toc-number">1.3.</span> <span class="toc-text">值转换器设置字符串的格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%80%BC%E8%BD%AC%E6%8D%A2%E5%99%A8%E5%88%9B%E5%BB%BA%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.4.</span> <span class="toc-text">值转换器创建对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E6%9D%A1%E4%BB%B6%E6%A0%BC%E5%BC%8F%E5%8C%96"><span class="toc-number">1.5.</span> <span class="toc-text">应用条件格式化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%84%E4%BC%B0%E5%A4%9A%E4%B8%AA%E5%B1%9E%E6%80%A7"><span class="toc-number">1.6.</span> <span class="toc-text">评估多个属性</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%97%E8%A1%A8%E6%8E%A7%E4%BB%B6"><span class="toc-number">2.</span> <span class="toc-text">列表控件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%97%E8%A1%A8%E6%A0%B7%E5%BC%8F"><span class="toc-number">3.</span> <span class="toc-text">列表样式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ItemContainerStyle"><span class="toc-number">3.1.</span> <span class="toc-text">ItemContainerStyle</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%85%E5%90%AB%E5%AD%90%E6%8E%A7%E4%BB%B6%E7%9A%84ListBox%E6%8E%A7%E4%BB%B6"><span class="toc-number">3.2.</span> <span class="toc-text">包含子控件的ListBox控件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%A4%E6%9B%BF%E6%9D%A1%E7%9B%AE%E6%A0%B7%E5%BC%8F"><span class="toc-number">3.3.</span> <span class="toc-text">交替条目样式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B7%E5%BC%8F%E9%80%89%E6%8B%A9%E5%99%A8"><span class="toc-number">3.4.</span> <span class="toc-text">样式选择器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%A8%A1%E6%9D%BF"><span class="toc-number">4.</span> <span class="toc-text">数据模板</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%A6%BB%E5%92%8C%E9%87%8D%E7%94%A8%E6%A8%A1%E6%9D%BF"><span class="toc-number">4.1.</span> <span class="toc-text">分离和重用模板</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%9B%B4%E9%AB%98%E7%BA%A7%E7%9A%84%E6%A8%A1%E6%9D%BF"><span class="toc-number">4.2.</span> <span class="toc-text">使用更高级的模板</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%B9%E5%8F%98%E6%A8%A1%E6%9D%BF"><span class="toc-number">4.3.</span> <span class="toc-text">改变模板</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E9%80%89%E6%8B%A9%E5%99%A8"><span class="toc-number">4.4.</span> <span class="toc-text">模板选择器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E4%B8%8E%E9%80%89%E6%8B%A9"><span class="toc-number">4.5.</span> <span class="toc-text">模板与选择</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%B9%E5%8F%98%E9%A1%B9%E7%9A%84%E5%B8%83%E5%B1%80"><span class="toc-number">4.6.</span> <span class="toc-text">改变项的布局</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ComboxBox%E6%8E%A7%E4%BB%B6"><span class="toc-number">5.</span> <span class="toc-text">ComboxBox控件</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/09/25/Docker/tutorials/03Dockerfile%E6%8C%87%E4%BB%A4%E8%AF%A6%E8%A7%A3/" title="03Dockerfile指令详解"><img src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/20240923232434.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="03Dockerfile指令详解"/></a><div class="content"><a class="title" href="/2024/09/25/Docker/tutorials/03Dockerfile%E6%8C%87%E4%BB%A4%E8%AF%A6%E8%A7%A3/" title="03Dockerfile指令详解">03Dockerfile指令详解</a><time datetime="2024-09-25T11:50:58.000Z" title="发表于 2024-09-25 19:50:58">2024-09-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/09/24/Docker/tutorials/02Docker%E9%95%9C%E5%83%8F/" title="02Docker镜像"><img src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/20240923232434.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="02Docker镜像"/></a><div class="content"><a class="title" href="/2024/09/24/Docker/tutorials/02Docker%E9%95%9C%E5%83%8F/" title="02Docker镜像">02Docker镜像</a><time datetime="2024-09-24T13:23:03.000Z" title="发表于 2024-09-24 21:23:03">2024-09-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/09/23/Docker/tutorials/01Docker%E5%AE%89%E8%A3%85/" title="01Docker安装"><img src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/20240923232434.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="01Docker安装"/></a><div class="content"><a class="title" href="/2024/09/23/Docker/tutorials/01Docker%E5%AE%89%E8%A3%85/" title="01Docker安装">01Docker安装</a><time datetime="2024-09-23T15:23:14.000Z" title="发表于 2024-09-23 23:23:14">2024-09-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/09/23/ASP.NETCore/middlewares/Identity%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81/" title="Identity身份认证"><img src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/20240923201143.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Identity身份认证"/></a><div class="content"><a class="title" href="/2024/09/23/ASP.NETCore/middlewares/Identity%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81/" title="Identity身份认证">Identity身份认证</a><time datetime="2024-09-23T12:10:08.000Z" title="发表于 2024-09-23 20:10:08">2024-09-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/09/22/ASP.NETCore/middlewares/Swagger%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3%E5%B7%A5%E5%85%B7/" title="Swagger接口文档工具"><img src= "/img/loading.gif" data-lazy-src="https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/20240922210954.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Swagger接口文档工具"/></a><div class="content"><a class="title" href="/2024/09/22/ASP.NETCore/middlewares/Swagger%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3%E5%B7%A5%E5%85%B7/" title="Swagger接口文档工具">Swagger接口文档工具</a><time datetime="2024-09-22T13:05:29.000Z" title="发表于 2024-09-22 21:05:29">2024-09-22</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://cnlicm-blog-image.oss-cn-shenzhen.aliyuncs.com/img/wpf.png')"><div id="footer-wrap"><div class="copyright">&copy;2024 By 大白</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><a target="_blank" rel="noopener external nofollow noreferrer" href="https://beian.miit.gov.cn/"><img class="icp-icon" src= "/img/loading.gif" data-lazy-src="/img/2020011362.png"><span>赣ICP备2020011362号-2</span></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="https://jsd.012700.xyz/npm/hexo-theme-butterfly@4.13.0/source/js/utils.min.js"></script><script src="https://jsd.012700.xyz/npm/hexo-theme-butterfly@4.13.0/source/js/main.min.js"></script><script src="https://jsd.012700.xyz/npm/hexo-theme-butterfly@4.13.0/source/js/tw_cn.min.js"></script><script src="https://jsd.012700.xyz/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><script src="https://jsd.012700.xyz/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://jsd.012700.xyz/npm/vanilla-lazyload@17.8.8/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaid.length === 0) return
  const runMermaid = () => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    Array.from($mermaid).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const loadMermaid = () => {
    window.loadMermaid ? runMermaid() : getScript('https://jsd.012700.xyz/npm/mermaid@10.8.0/dist/mermaid.min.js').then(runMermaid)
  }

  btf.addGlobalFn('themeChange', runMermaid, 'mermaid')

  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script data-pjax src="/self/btf.js"></script><script defer="defer" id="ribbon" src="https://jsd.012700.xyz/npm/butterfly-extsrc@1.1.3/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="true" data-click="true"></script><script src="https://jsd.012700.xyz/npm/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"]):not([href="/talking/"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener
  btf.removeGlobalFnEvent('pjax')
  btf.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="https://jsd.012700.xyz/npm/hexo-theme-butterfly@4.13.0/source/js/search/local-search.min.js"></script></div></div></body></html>